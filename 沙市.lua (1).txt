repeat task.wait() until game:IsLoaded()

local library = {}
library.currentTab = nil
library.flags = {}

local configPath = "BS脚本/UI配置.txt"

local function saveConfig(config)
	local success, encoded = pcall(function()
		return game:GetService("HttpService"):JSONEncode(config)
	end)
	if success then
		if not isfolder("BS脚本") then makefolder("BS脚本") end
		if isfile(configPath) then delfile(configPath) end
		writefile(configPath, encoded)
	end
end

local function loadConfig()
	if isfile(configPath) then
		local success, config = pcall(function()
			return game:GetService("HttpService"):JSONDecode(readfile(configPath))
		end)
		if success then return config end
	end
	return {autoFitScreen = false, windowSize = {650, 400}, windowPosition = {0.5, 0.5}}
end

local services = setmetatable({}, {__index = function(t, k) return game:GetService(k) end})
local RunService = services.RunService
local TweenService = services.TweenService
local UserInputService = services.UserInputService
local Players = services.Players
local HttpService = game:GetService("HttpService")

local isComputer = not UserInputService.TouchEnabled
local scaleFactor = isComputer and 1.4 or 0.8

local Colors = {
	Primary = Color3.fromRGB(15, 15, 15),
	Secondary = Color3.fromRGB(30, 30, 30),
	Accent = Color3.fromRGB(52, 152, 219),
	Text = Color3.fromRGB(240, 240, 240),
	Placeholder = Color3.fromRGB(150, 150, 150),
	White = Color3.fromRGB(255, 255, 255),
	Transparent = 0.25,
}

local function Tween(obj, duration, style, direction, data)
	TweenService:Create(obj, TweenInfo.new(duration, Enum.EasingStyle[style], Enum.EasingDirection[direction]), data):Play()
end

local Part = Instance.new("Part")
Part.Name = "LU_" .. HttpService:GenerateGUID()
Part.Anchored = true
Part.CanCollide = false
Part.Locked = true
Part.Transparency = 0
Part.Size = Vector3.new(18 * scaleFactor, 8 * scaleFactor, 2)
Part.Parent = workspace

local SurfaceUI = Instance.new("SurfaceGui")
SurfaceUI.Name = "MainSurfaceGui"
SurfaceUI.Adornee = Part
SurfaceUI.Face = Enum.NormalId.Back
SurfaceUI.SizingMode = Enum.SurfaceGuiSizingMode.PixelsPerStud
SurfaceUI.ClipsDescendants = true
SurfaceUI.AlwaysOnTop = true
SurfaceUI.Enabled = true
SurfaceUI.Parent = Part

local SCALE = 0.01
local LookView = Vector3.new(0, 0.08 * scaleFactor, -9 * scaleFactor)
local PartIncreased = false

RunService.RenderStepped:Connect(function(deltaTime)
	local mouse = Players.LocalPlayer:GetMouse()
	local cam = workspace.CurrentCamera
	if not cam then return end
	
	local mouseX = (mouse.X - mouse.ViewSizeX/2) * SCALE
	local mouseY = (mouse.Y - mouse.ViewSizeY/2) * SCALE
	local goalCF = cam.CFrame * CFrame.new(LookView) * CFrame.Angles(0, math.rad(mouseX), 0) * CFrame.Angles(math.rad(mouseY), 0, 0)
	TweenService:Create(Part, TweenInfo.new(deltaTime), {CFrame = goalCF}):Play()
end)

spawn(function()
	while Part.Parent do
		local delta = PartIncreased and -0.08 * scaleFactor or 0.08 * scaleFactor
		TweenService:Create(Part, TweenInfo.new(1), {Size = Part.Size + Vector3.new(delta, delta, delta)}):Play()
		task.wait(1)
		PartIncreased = not PartIncreased
	end
end)

function library.new(name)
	for _, v in pairs(services.CoreGui:GetChildren()) do if v.Name == "REN" then v:Destroy() end end
	for _, obj in pairs(workspace:GetChildren()) do if obj.Name:match("^LU_") and obj:IsA("Part") then obj:Destroy() end end
	
	local ScreenGui = Instance.new("ScreenGui")
	ScreenGui.Name = "REN"
	ScreenGui.Parent = services.CoreGui
	
	local OpenBtn = Instance.new("TextButton")
	OpenBtn.Name = "Open"
	OpenBtn.Parent = ScreenGui
	OpenBtn.BackgroundColor3 = Colors.Primary
	OpenBtn.BackgroundTransparency = Colors.Transparent
	OpenBtn.Position = UDim2.new(0.01, 0, 0.3, 0)
	OpenBtn.Size = UDim2.new(0, 70 * scaleFactor, 0, 35 * scaleFactor)
	OpenBtn.Font = Enum.Font.GothamBold
	OpenBtn.Text = "BS"
	OpenBtn.TextColor3 = Colors.Text
	OpenBtn.TextSize = 14 * scaleFactor
	OpenBtn.Active = true
	OpenBtn.Draggable = true
	
	local OpenC = Instance.new("UICorner", OpenBtn)
	OpenC.CornerRadius = UDim.new(0, 6)
	
	OpenBtn.MouseButton1Click:Connect(function()
		Part.Transparency = Part.Transparency == 1 and 0 or 1
	end)
	
	UserInputService.InputEnded:Connect(function(input)
		if input.KeyCode == Enum.KeyCode.LeftControl then
			Part.Transparency = Part.Transparency == 1 and 0 or 1
		end
	end)
	
	local Main3D = Instance.new("Frame")
	Main3D.Name = "Main3D"
	Main3D.Parent = SurfaceUI
	Main3D.Size = UDim2.new(1, 0, 1, 0)
	Main3D.BackgroundTransparency = 1
	Main3D.BorderSizePixel = 0
	
	local Main = Instance.new("Frame")
	Main.Name = "Main"
	Main.Parent = Main3D
	Main.AnchorPoint = Vector2.new(0.5, 0.5)
	Main.BackgroundColor3 = Colors.Primary
	Main.Size = UDim2.new(0, 650 * scaleFactor, 0, 400 * scaleFactor)
	Main.Position = UDim2.new(0.5, 0, 0.5, 0)
	Main.ZIndex = 1
	
	local MainC = Instance.new("UICorner", Main)
	MainC.CornerRadius = UDim.new(0, 8)
	
	local BackgroundImage = Instance.new("ImageLabel")
	BackgroundImage.Name = "BackgroundImage"
	BackgroundImage.Parent = Main
	BackgroundImage.Size = UDim2.new(1, 0, 1, 0)
	BackgroundImage.BackgroundTransparency = 1
	BackgroundImage.Image = "rbxassetid://102621341311637"
	BackgroundImage.ImageTransparency = 0.5
	BackgroundImage.ZIndex = 0
	
	local TitleBar = Instance.new("Frame")
	TitleBar.Name = "TitleBar"
	TitleBar.Parent = Main
	TitleBar.BackgroundColor3 = Colors.Secondary
	TitleBar.BackgroundTransparency = Colors.Transparent
	TitleBar.Size = UDim2.new(1, 0, 0, 45 * scaleFactor)
	
	local Title = Instance.new("TextLabel")
	Title.Name = "ScriptTitle"
	Title.Parent = TitleBar
	Title.BackgroundTransparency = 1
	Title.Position = UDim2.new(0, 15 * scaleFactor, 0, 0)
	Title.Size = UDim2.new(1, -30 * scaleFactor, 1, 0)
	Title.Font = Enum.Font.GothamBlack
	Title.Text = name or "UI Library"
	Title.TextColor3 = Colors.Text
	Title.TextSize = 18 * scaleFactor
	
	local SearchBar = Instance.new("Frame")
	SearchBar.Name = "SearchBar"
	SearchBar.Parent = Main
	SearchBar.BackgroundColor3 = Colors.Secondary
	SearchBar.BackgroundTransparency = Colors.Transparent
	SearchBar.Position = UDim2.new(0, 15 * scaleFactor, 0, 55 * scaleFactor)
	SearchBar.Size = UDim2.new(1, -30 * scaleFactor, 0, 35 * scaleFactor)
	
	local SearchBox = Instance.new("TextBox")
	SearchBox.Name = "SearchBox"
	SearchBox.Parent = SearchBar
	SearchBox.BackgroundTransparency = 1
	SearchBox.Position = UDim2.new(0, 40 * scaleFactor, 0, 0)
	SearchBox.Size = UDim2.new(1, -50 * scaleFactor, 1, 0)
	SearchBox.Font = Enum.Font.Gotham
	SearchBox.PlaceholderText = "搜索标签页或功能..."
	SearchBox.Text = ""
	SearchBox.TextColor3 = Colors.Text
	SearchBox.ClearTextOnFocus = true
	
	local Content = Instance.new("Frame")
	Content.Name = "Content"
	Content.Parent = Main
	Content.BackgroundTransparency = 1
	Content.Position = UDim2.new(0, 0, 0, 100 * scaleFactor)
	Content.Size = UDim2.new(1, 0, 1, -100 * scaleFactor)
	
	local SideBar = Instance.new("Frame")
	SideBar.Name = "SideBar"
	SideBar.Parent = Content
	SideBar.BackgroundColor3 = Colors.Secondary
	SideBar.BackgroundTransparency = Colors.Transparent
	SideBar.Size = UDim2.new(0, 140 * scaleFactor, 1, 0)
	
	local TabButtons = Instance.new("ScrollingFrame")
	TabButtons.Name = "TabBts"
	TabButtons.Parent = SideBar
	TabButtons.BackgroundTransparency = 1
	TabButtons.Position = UDim2.new(0, 5, 0, 5)
	TabButtons.Size = UDim2.new(1, -10, 1, -10)
	TabButtons.ScrollBarThickness = 2
	
	local TabButtonsL = Instance.new("UIListLayout")
	TabButtonsL.Parent = TabButtons
	TabButtonsL.SortOrder = Enum.SortOrder.LayoutOrder
	TabButtonsL.Padding = UDim.new(0, 8)
	
	local TabMain = Instance.new("Frame")
	TabMain.Name = "TabMain"
	TabMain.Parent = Content
	TabMain.BackgroundTransparency = 1
	TabMain.Position = UDim2.new(0, 145 * scaleFactor, 0, 0)
	TabMain.Size = UDim2.new(1, -145 * scaleFactor, 1, 0)
	
	Part.Transparency = 0
	
	local window = {
		Tab = function(self, name, icon)
			local tabButton = Instance.new("Frame")
			tabButton.Name = "TabButton"
			tabButton.Parent = TabButtons
			tabButton.BackgroundColor3 = Colors.Secondary
			tabButton.BackgroundTransparency = 0.3
			tabButton.Size = UDim2.new(1, 0, 0, 40 * scaleFactor)
			
			local tabButtonC = Instance.new("UICorner")
			tabButtonC.CornerRadius = UDim.new(0, 6)
			tabButtonC.Parent = tabButton
			
			local tabIcon = Instance.new("ImageLabel")
			tabIcon.Name = "TabIcon"
			tabIcon.Parent = tabButton
			tabIcon.BackgroundTransparency = 1
			tabIcon.Position = UDim2.new(0, 10 * scaleFactor, 0.5, -12 * scaleFactor)
			tabIcon.Size = UDim2.new(0, 24 * scaleFactor, 0, 24 * scaleFactor)
			tabIcon.Image = ("rbxassetid://%s"):format(icon or 4370341699)
			tabIcon.ImageColor3 = Colors.Text
			
			local tabText = Instance.new("TextLabel")
			tabText.Name = "TabText"
			tabText.Parent = tabButton
			tabText.BackgroundTransparency = 1
			tabText.Position = UDim2.new(0, 45 * scaleFactor, 0, 0)
			tabText.Size = UDim2.new(1, -50 * scaleFactor, 1, 0)
			tabText.Font = Enum.Font.GothamSemibold
			tabText.Text = name
			tabText.TextColor3 = Colors.Text
			tabText.TextSize = 14 * scaleFactor
			tabText.TextXAlignment = Enum.TextXAlignment.Left
			
			local tabBtn = Instance.new("TextButton")
			tabBtn.Name = "TabBtn"
			tabBtn.Parent = tabButton
			tabBtn.BackgroundTransparency = 1
			tabBtn.Size = UDim2.new(1, 0, 1, 0)
			tabBtn.Text = ""
			
			local tabFrame = Instance.new("ScrollingFrame")
			tabFrame.Name = "Tab"
			tabFrame.Parent = TabMain
			tabFrame.BackgroundTransparency = 1
			tabFrame.Size = UDim2.new(1, 0, 1, 0)
			tabFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
			tabFrame.ScrollBarThickness = 2
			tabFrame.Visible = false
			
			local tabL = Instance.new("UIListLayout")
			tabL.Parent = tabFrame
			tabL.SortOrder = Enum.SortOrder.LayoutOrder
			tabL.Padding = UDim.new(0, 8)
			
			local tabInfo = {
				name = name,
				button = tabButton,
				frame = tabFrame,
				searchableComponents = {},
				sections = {}
			}
			
			tabBtn.MouseButton1Click:Connect(function()
				if library.currentTab and library.currentTab.button == tabButton then return end
				
				if library.currentTab then
					library.currentTab.frame.Visible = false
					Tween(library.currentTab.button, 0.15, "Sine", "Out", {BackgroundTransparency = 0.3})
					Tween(library.currentTab.button:FindFirstChild("TabText"), 0.15, "Sine", "Out", {TextTransparency = 0.3})
				end
				
				library.currentTab = tabInfo
				tabFrame.Visible = true
				Tween(tabButton, 0.15, "Sine", "Out", {BackgroundTransparency = 0})
				Tween(tabText, 0.15, "Sine", "Out", {TextTransparency = 0})
			end
			
			if not library.currentTab then
				library.currentTab = tabInfo
				tabFrame.Visible = true
				Tween(tabButton, 0, "Sine", "Out", {BackgroundTransparency = 0})
				Tween(tabText, 0, "Sine", "Out", {TextTransparency = 0})
			end
			
			tabL:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
				tabFrame.CanvasSize = UDim2.new(0, 0, 0, tabL.AbsoluteContentSize.Y + 16)
			end)
			
			local tab = {}
			tab._info = tabInfo
			
			function tab.section(tab, name, TabVal)
				local Section = Instance.new("Frame")
				Section.Name = "Section"
				Section.Parent = tabFrame
				Section.BackgroundColor3 = Colors.Secondary
				Section.BackgroundTransparency = Colors.Transparent
				Section.BorderSizePixel = 0
				Section.ClipsDescendants = true
				Section.Size = UDim2.new(0.975, 0, 0, (TabVal ~= false and (42 + 10) or 42) * scaleFactor)
				
				local SectionC = Instance.new("UICorner")
				SectionC.CornerRadius = UDim.new(0, 8)
				SectionC.Parent = Section
				
				local SectionText = Instance.new("TextLabel")
				SectionText.Name = "SectionText"
				SectionText.Parent = Section
				SectionText.BackgroundTransparency = 1
				SectionText.Position = UDim2.new(0, 40 * scaleFactor, 0, 0)
				SectionText.Size = UDim2.new(1, -45 * scaleFactor, 0, 42 * scaleFactor)
				SectionText.Font = Enum.Font.GothamBold
				SectionText.Text = name
				SectionText.TextColor3 = Colors.Text
				SectionText.TextSize = 16 * scaleFactor
				SectionText.TextXAlignment = Enum.TextXAlignment.Left
				
				local SectionOpen = Instance.new("ImageLabel")
				SectionOpen.Name = "SectionOpen"
				SectionOpen.Parent = SectionText
				SectionOpen.BackgroundTransparency = 1
				SectionOpen.BorderSizePixel = 0
				SectionOpen.Position = UDim2.new(0, -30 * scaleFactor, 0, 8 * scaleFactor)
				SectionOpen.Size = UDim2.new(0, 26 * scaleFactor, 0, 26 * scaleFactor)
				SectionOpen.Image = "http://www.roblox.com/asset/?id=6031302934"
				SectionOpen.ImageColor3 = Colors.Text
				
				local SectionOpened = Instance.new("ImageLabel")
				SectionOpened.Name = "SectionOpened"
				SectionOpened.Parent = SectionOpen
				SectionOpened.BackgroundTransparency = 1.000
				SectionOpened.BorderSizePixel = 0
				SectionOpened.Size = UDim2.new(0, 26 * scaleFactor, 0, 26 * scaleFactor)
				SectionOpened.Image = "http://www.roblox.com/asset/?id=6031302932"
				SectionOpened.ImageTransparency = 1.000
				SectionOpened.ImageColor3 = Colors.Text
				
				local SectionToggle = Instance.new("ImageButton")
				SectionToggle.Name = "SectionToggle"
				SectionToggle.Parent = SectionOpen
				SectionToggle.BackgroundTransparency = 1
				SectionToggle.BorderSizePixel = 0
				SectionToggle.Size = UDim2.new(0, 26 * scaleFactor, 0, 26 * scaleFactor)
				
				local Objs = Instance.new("Frame")
				Objs.Name = "Objs"
				Objs.Parent = Section
				Objs.BackgroundTransparency = 1
				Objs.BorderSizePixel = 0
				Objs.Position = UDim2.new(0, 6 * scaleFactor, 0, 42 * scaleFactor)
				Objs.Size = UDim2.new(1, -12 * scaleFactor, 0, 0)
				
				local ObjsL = Instance.new("UIListLayout")
				ObjsL.Name = "ObjsL"
				ObjsL.Parent = Objs
				ObjsL.SortOrder = Enum.SortOrder.LayoutOrder
				ObjsL.Padding = UDim.new(0, 8)
				
				local open = TabVal
				if TabVal ~= false then
					Section.Size = UDim2.new(0.975, 0, 0, (open and (42 + ObjsL.AbsoluteContentSize.Y + 10) or 42) * scaleFactor)
					SectionOpened.ImageTransparency = (open and 0 or 1)
					SectionOpen.ImageTransparency = (open and 1 or 0)
				end
				
				SectionToggle.MouseButton1Click:Connect(function()
					open = not open
					Section.Size = UDim2.new(0.975, 0, 0, (open and (42 + ObjsL.AbsoluteContentSize.Y + 10) or 42) * scaleFactor)
					SectionOpened.ImageTransparency = (open and 0 or 1)
					SectionOpen.ImageTransparency = (open and 1 or 0)
					Tween(Section, 0.2, "Sine", "Out", {BackgroundTransparency = open and 0.25 or 0})
				end)
				
				ObjsL:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
					if not open then return end
					Section.Size = UDim2.new(0.975, 0, 0, (42 + ObjsL.AbsoluteContentSize.Y + 10) * scaleFactor)
				end)
				
				local sectionInfo = {
					name = name,
					section = Section,
					objsFrame = Objs,
					components = {},
					originalTexts = {}
				}
				table.insert(tabInfo.sections, sectionInfo)
				
				local section = {}
				
				function section.Button(section, text, callback)
					local callback = callback or function() end
					table.insert(tabInfo.searchableComponents, text)
					table.insert(sectionInfo.components, text)
					local BtnModule = Instance.new("Frame")
					BtnModule.Name = "BtnModule"
					BtnModule.Parent = Objs
					BtnModule.BackgroundTransparency = 1
					BtnModule.Size = UDim2.new(1, 0, 0, 40 * scaleFactor)
					
					local Btn = Instance.new("TextButton")
					Btn.Name = "Btn"
					Btn.Parent = BtnModule
					Btn.BackgroundColor3 = Colors.Secondary
					Btn.BackgroundTransparency = 0.3
					Btn.Size = UDim2.new(1, 0, 1, 0)
					Btn.AutoButtonColor = false
					Btn.Font = Enum.Font.GothamSemibold
					Btn.Text = "   " .. text
					Btn.TextColor3 = Colors.Text
					Btn.TextSize = 15 * scaleFactor
					Btn.TextXAlignment = Enum.TextXAlignment.Left
					
					local BtnC = Instance.new("UICorner")
					BtnC.CornerRadius = UDim.new(0, 6)
					BtnC.Parent = Btn
					
					sectionInfo.originalTexts[BtnModule] = text
					
					Btn.MouseButton1Click:Connect(function()
						spawn(callback)
					end)
				end
				
				function section:Label(text)
					table.insert(tabInfo.searchableComponents, text)
					table.insert(sectionInfo.components, text)
					local LabelModule = Instance.new("Frame")
					LabelModule.Name = "LabelModule"
					LabelModule.Parent = Objs
					LabelModule.BackgroundTransparency = 1
					LabelModule.Size = UDim2.new(1, 0, 0, 30 * scaleFactor)
					
					local TextLabel = Instance.new("TextLabel")
					TextLabel.Parent = LabelModule
					TextLabel.BackgroundColor3 = Colors.Secondary
					TextLabel.BackgroundTransparency = 0.3
					TextLabel.Size = UDim2.new(1, 0, 1, 0)
					TextLabel.Font = Enum.Font.GothamSemibold
					TextLabel.Text = text
					TextLabel.TextColor3 = Colors.Text
					TextLabel.TextSize = 14 * scaleFactor
					TextLabel.TextWrapped = true
					
					local LabelC = Instance.new("UICorner")
					LabelC.CornerRadius = UDim.new(0, 6)
					LabelC.Parent = TextLabel
					
					sectionInfo.originalTexts[LabelModule] = text
					
					return TextLabel
				end
				
				function section.Toggle(section, text, flag, enabled, callback)
					local callback = callback or function() end
					local enabled = enabled or false
					library.flags[flag] = enabled
					table.insert(tabInfo.searchableComponents, text)
					table.insert(sectionInfo.components, text)
					
					local ToggleModule = Instance.new("Frame")
					ToggleModule.Name = "ToggleModule"
					ToggleModule.Parent = Objs
					ToggleModule.BackgroundTransparency = 1
					ToggleModule.Size = UDim2.new(1, 0, 0, 40 * scaleFactor)
					
					local ToggleBtn = Instance.new("TextButton")
					ToggleBtn.Name = "ToggleBtn"
					ToggleBtn.Parent = ToggleModule
					ToggleBtn.BackgroundColor3 = Colors.Secondary
					ToggleBtn.BackgroundTransparency = 0.3
					ToggleBtn.Size = UDim2.new(1, 0, 1, 0)
					ToggleBtn.AutoButtonColor = false
					ToggleBtn.Font = Enum.Font.GothamSemibold
					ToggleBtn.Text = "   " .. text
					ToggleBtn.TextColor3 = Colors.Text
					ToggleBtn.TextSize = 15 * scaleFactor
					ToggleBtn.TextXAlignment = Enum.TextXAlignment.Left
					
					local ToggleBtnC = Instance.new("UICorner")
					ToggleBtnC.CornerRadius = UDim.new(0, 6)
					ToggleBtnC.Parent = ToggleBtn
					
					local ToggleDisable = Instance.new("Frame")
					ToggleDisable.Name = "ToggleDisable"
					ToggleDisable.Parent = ToggleBtn
					ToggleDisable.BackgroundColor3 = Colors.Primary
					ToggleDisable.BackgroundTransparency = 0.5
					ToggleDisable.BorderSizePixel = 0
					ToggleDisable.Position = UDim2.new(1, -38 * scaleFactor, 0.5, -13 * scaleFactor)
					ToggleDisable.Size = UDim2.new(0, 26 * scaleFactor, 0, 26 * scaleFactor)
					
					local ToggleSwitch = Instance.new("Frame")
					ToggleSwitch.Name = "ToggleSwitch"
					ToggleSwitch.Parent = ToggleDisable
					ToggleSwitch.BackgroundColor3 = Colors.White
					ToggleSwitch.Size = UDim2.new(0, 22 * scaleFactor, 0, 22 * scaleFactor)
					ToggleSwitch.Position = UDim2.new(0, 2, 0, 2)
					
					local ToggleDisableC = Instance.new("UICorner")
					ToggleDisableC.CornerRadius = UDim.new(0, 6)
					ToggleDisableC.Parent = ToggleDisable
					
					local ToggleSwitchC = Instance.new("UICorner")
					ToggleSwitchC.CornerRadius = UDim.new(0, 4)
					ToggleSwitchC.Parent = ToggleSwitch
					
					local funcs = {
						SetState = function(self, state)
							if state == nil then state = not library.flags[flag] end
							if library.flags[flag] == state then return end
							Tween(ToggleSwitch, 0.15, "Sine", "Out", {
								Position = UDim2.new(0, (state and 2 or 2), 0, 2),
								BackgroundColor3 = state and Color3.fromRGB(52, 152, 219) or Colors.White
							})
							library.flags[flag] = state
							callback(state)
						end,
						Module = ToggleModule,
					}
					
					if enabled then funcs:SetState(true) end
					
					ToggleBtn.MouseButton1Click:Connect(function() funcs:SetState() end)
					
					return funcs
				end
				
				function section.Keybind(section, text, default, callback)
					local callback = callback or function() end
					local default = (typeof(default) == "string" and Enum.KeyCode[default] or default)
					local banned = {
						Return = true, Space = true, Tab = true, Backquote = true,
						CapsLock = true, Escape = true, Unknown = true,
					}
					local shortNames = {
						RightControl = "Right Ctrl", LeftControl = "Left Ctrl",
						LeftShift = "Left Shift", RightShift = "Right Shift",
						Semicolon = ";", Quote = '"', LeftBracket = "[", RightBracket = "]",
						Equals = "=", Minus = "-", RightAlt = "Right Alt", LeftAlt = "Left Alt",
					}
					local bindKey = default
					local keyTxt = (default and (shortNames[default.Name] or default.Name) or "None")
					table.insert(tabInfo.searchableComponents, text)
					table.insert(sectionInfo.components, text)
					
					local KeybindModule = Instance.new("Frame")
					KeybindModule.Name = "KeybindModule"
					KeybindModule.Parent = Objs
					KeybindModule.BackgroundTransparency = 1
					KeybindModule.Size = UDim2.new(1, 0, 0, 40 * scaleFactor)
					
					local KeybindBtn = Instance.new("TextButton")
					KeybindBtn.Name = "KeybindBtn"
					KeybindBtn.Parent = KeybindModule
					KeybindBtn.BackgroundColor3 = Colors.Secondary
					KeybindBtn.BackgroundTransparency = 0.3
					KeybindBtn.Size = UDim2.new(1, 0, 1, 0)
					KeybindBtn.AutoButtonColor = false
					KeybindBtn.Font = Enum.Font.GothamSemibold
					KeybindBtn.Text = "   " .. text
					KeybindBtn.TextColor3 = Colors.Text
					KeybindBtn.TextSize = 15 * scaleFactor
					KeybindBtn.TextXAlignment = Enum.TextXAlignment.Left
					
					local KeybindBtnC = Instance.new("UICorner")
					KeybindBtnC.CornerRadius = UDim.new(0, 6)
					KeybindBtnC.Parent = KeybindBtn
					
					local KeybindValue = Instance.new("TextButton")
					KeybindValue.Name = "KeybindValue"
					KeybindValue.Parent = KeybindBtn
					KeybindValue.BackgroundColor3 = Colors.Primary
					KeybindValue.BackgroundTransparency = 0.5
					KeybindValue.Position = UDim2.new(0.6, 0, 0.5, -14 * scaleFactor)
					KeybindValue.Size = UDim2.new(0, 55 * scaleFactor, 0, 28 * scaleFactor)
					KeybindValue.AutoButtonColor = false
					KeybindValue.Font = Enum.Font.GothamSemibold
					KeybindValue.Text = keyTxt
					KeybindValue.TextColor3 = Colors.Text
					KeybindValue.TextSize = 14 * scaleFactor
					
					local KeybindValueC = Instance.new("UICorner")
					KeybindValueC.CornerRadius = UDim.new(0, 6)
					KeybindValueC.Parent = KeybindValue
					
					UserInputService.InputBegan:Connect(function(inp, gpe)
						if gpe then return end
						if inp.UserInputType ~= Enum.UserInputType.Keyboard then return end
						if inp.KeyCode ~= bindKey then return end
						callback(bindKey.Name)
					end)
					
					KeybindValue.MouseButton1Click:Connect(function()
						KeybindValue.Text = "..."
						wait()
						local key = UserInputService.InputEnded:Wait()
						local keyName = tostring(key.KeyCode.Name)
						if key.UserInputType ~= Enum.UserInputType.Keyboard then
							KeybindValue.Text = keyTxt
							return
						end
						if banned[keyName] then
							KeybindValue.Text = keyTxt
							return
						end
						wait()
						bindKey = Enum.KeyCode[keyName]
						local displayName = shortNames[keyName] or keyName
						KeybindValue.Text = displayName
						keyTxt = displayName
					end)
					
					KeybindValue:GetPropertyChangedSignal("TextBounds"):Connect(function()
						KeybindValue.Size = UDim2.new(0, KeybindValue.TextBounds.X + 30 * scaleFactor, 0, 28 * scaleFactor)
					end)
					
					KeybindValue.Size = UDim2.new(0, KeybindValue.TextBounds.X + 30 * scaleFactor, 0, 28 * scaleFactor)
				end
				
				function section.Textbox(section, text, flag, default, callback)
					local callback = callback or function() end
					library.flags[flag] = default
					table.insert(tabInfo.searchableComponents, text)
					table.insert(sectionInfo.components, text)
					
					local TextboxModule = Instance.new("Frame")
					TextboxModule.Name = "TextboxModule"
					TextboxModule.Parent = Objs
					TextboxModule.BackgroundTransparency = 1
					TextboxModule.Size = UDim2.new(1, 0, 0, 40 * scaleFactor)
					
					local TextboxBack = Instance.new("TextButton")
					TextboxBack.Name = "TextboxBack"
					TextboxBack.Parent = TextboxModule
					TextboxBack.BackgroundColor3 = Colors.Secondary
					TextboxBack.BackgroundTransparency = 0.3
					TextboxBack.Size = UDim2.new(1, 0, 1, 0)
					TextboxBack.AutoButtonColor = false
					TextboxBack.Font = Enum.Font.GothamSemibold
					TextboxBack.Text = "   " .. text
					TextboxBack.TextColor3 = Colors.Text
					TextboxBack.TextSize = 15 * scaleFactor
					TextboxBack.TextXAlignment = Enum.TextXAlignment.Left
					
					local TextboxBackC = Instance.new("UICorner")
					TextboxBackC.CornerRadius = UDim.new(0, 6)
					TextboxBackC.Parent = TextboxBack
					
					local BoxBG = Instance.new("TextButton")
					BoxBG.Name = "BoxBG"
					BoxBG.Parent = TextboxBack
					BoxBG.BackgroundColor3 = Colors.Primary
					BoxBG.BackgroundTransparency = 0.5
					BoxBG.Position = UDim2.new(0.6, 0, 0.5, -14 * scaleFactor)
					BoxBG.Size = UDim2.new(0, 90 * scaleFactor, 0, 28 * scaleFactor)
					BoxBG.AutoButtonColor = false
					BoxBG.Text = ""
					
					local BoxBGC = Instance.new("UICorner")
					BoxBGC.CornerRadius = UDim.new(0, 6)
					BoxBGC.Parent = BoxBG
					
					local TB = Instance.new("TextBox")
					TB.Name = "TextBox"
					TB.Parent = BoxBG
					TB.BackgroundTransparency = 1
					TB.Size = UDim2.new(1, 0, 1, 0)
					TB.Font = Enum.Font.Gotham
					TB.Text = default
					TB.TextColor3 = Colors.Text
					TB.ClearTextOnFocus = true
					
					TB.FocusLost:Connect(function()
						if TB.Text == "" then
							TB.Text = default
						end
						library.flags[flag] = TB.Text
						callback(TB.Text)
					end)
					
					TB:GetPropertyChangedSignal("TextBounds"):Connect(function()
						BoxBG.Size = UDim2.new(0, TB.TextBounds.X + 40 * scaleFactor, 0, 28 * scaleFactor)
					end)
					
					BoxBG.Size = UDim2.new(0, TB.TextBounds.X + 40 * scaleFactor, 0, 28 * scaleFactor)
					
					return {
						GetValue = function() return TB.Text end,
						SetValue = function(self, value)
							TB.Text = tostring(value)
							library.flags[flag] = value
							callback(value)
						end,
						Module = TextboxModule
					}
				end
				
				function section.Slider(section, text, flag, default, min, max, precise, callback)
					local callback = callback or function() end
					local min = min or 1
					local max = max or 10
					local default = default or min
					local precise = precise or false
					library.flags[flag] = default
					table.insert(tabInfo.searchableComponents, text)
					table.insert(sectionInfo.components, text)
					
					local SliderModule = Instance.new("Frame")
					SliderModule.Name = "SliderModule"
					SliderModule.Parent = Objs
					SliderModule.BackgroundTransparency = 1
					SliderModule.ClipsDescendants = true
					SliderModule.Size = UDim2.new(1, 0, 0, 40 * scaleFactor)
					
					local SliderBack = Instance.new("TextButton")
					SliderBack.Name = "SliderBack"
					SliderBack.Parent = SliderModule
					SliderBack.BackgroundColor3 = Colors.Secondary
					SliderBack.BackgroundTransparency = 0.3
					SliderBack.Size = UDim2.new(1, 0, 1, 0)
					SliderBack.AutoButtonColor = false
					SliderBack.Font = Enum.Font.GothamSemibold
					SliderBack.Text = "   " .. text
					SliderBack.TextColor3 = Colors.Text
					SliderBack.TextSize = 15 * scaleFactor
					SliderBack.TextXAlignment = Enum.TextXAlignment.Left
					
					local SliderBackC = Instance.new("UICorner")
					SliderBackC.CornerRadius = UDim.new(0, 6)
					SliderBackC.Parent = SliderBack
					
					local SliderBar = Instance.new("Frame")
					SliderBar.Name = "SliderBar"
					SliderBar.Parent = SliderBack
					SliderBar.AnchorPoint = Vector2.new(0, 0.5)
					SliderBar.BackgroundColor3 = Colors.Primary
					SliderBar.BackgroundTransparency = 0.5
					SliderBar.BorderSizePixel = 0
					SliderBar.Position = UDim2.new(0.6, 0, 0.5, 0)
					SliderBar.Size = UDim2.new(0, 120 * scaleFactor, 0, 6 * scaleFactor)
					
					local SliderBarC = Instance.new("UICorner")
					SliderBarC.CornerRadius = UDim.new(0, 3)
					SliderBarC.Parent = SliderBar
					
					local SliderPart = Instance.new("Frame")
					SliderPart.Name = "SliderPart"
					SliderPart.Parent = SliderBar
					SliderPart.BackgroundColor3 = Colors.Accent
					SliderPart.Size = UDim2.new(0.5, 0, 1, 0)
					
					local SliderPartC = Instance.new("UICorner")
					SliderPartC.CornerRadius = UDim.new(0, 3)
					SliderPartC.Parent = SliderPart
					
					local SliderValBG = Instance.new("TextButton")
					SliderValBG.Name = "SliderValBG"
					SliderValBG.Parent = SliderBack
					SliderValBG.BackgroundColor3 = Colors.Primary
					SliderValBG.BackgroundTransparency = 0.5
					SliderValBG.Position = UDim2.new(0.65, 0, 0.5, -14 * scaleFactor)
					SliderValBG.Size = UDim2.new(0, 40 * scaleFactor, 0, 28 * scaleFactor)
					SliderValBG.AutoButtonColor = false
					SliderValBG.Font = Enum.Font.Gotham
					SliderValBG.Text = ""
					
					local SliderValBGC = Instance.new("UICorner")
					SliderValBGC.CornerRadius = UDim.new(0, 6)
					SliderValBGC.Parent = SliderValBG
					
					local SliderValue = Instance.new("TextBox")
					SliderValue.Name = "SliderValue"
					SliderValue.Parent = SliderValBG
					SliderValue.BackgroundTransparency = 1
					SliderValue.Size = UDim2.new(1, 0, 1, 0)
					SliderValue.Font = Enum.Font.GothamSemibold
					SliderValue.Text = tostring(default)
					SliderValue.TextColor3 = Colors.Text
					SliderValue.TextSize = 14 * scaleFactor
					SliderValue.ClearTextOnFocus = true
					
					local MinSlider = Instance.new("TextButton")
					MinSlider.Name = "MinSlider"
					MinSlider.Parent = SliderBack
					MinSlider.BackgroundTransparency = 1
					MinSlider.Position = UDim2.new(0.6, -10, 0.5, -10 * scaleFactor)
					MinSlider.Size = UDim2.new(0, 20 * scaleFactor, 0, 20 * scaleFactor)
					MinSlider.Font = Enum.Font.GothamBold
					MinSlider.Text = "-"
					MinSlider.TextColor3 = Colors.Text
					MinSlider.TextSize = 20 * scaleFactor
					
					local AddSlider = Instance.new("TextButton")
					AddSlider.Name = "AddSlider"
					AddSlider.Parent = SliderBack
					AddSlider.AnchorPoint = Vector2.new(0, 0.5)
					AddSlider.BackgroundTransparency = 1
					AddSlider.Position = UDim2.new(0.6, 125 * scaleFactor, 0.5, -10 * scaleFactor)
					AddSlider.Size = UDim2.new(0, 20 * scaleFactor, 0, 20 * scaleFactor)
					AddSlider.Font = Enum.Font.GothamBold
					AddSlider.Text = "+"
					AddSlider.TextColor3 = Colors.Text
					AddSlider.TextSize = 20 * scaleFactor
					
					local funcs = {
						SetValue = function(self, value)
							local percent = (mouse.X - SliderBar.AbsolutePosition.X) / SliderBar.AbsoluteSize.X
							if value then percent = (value - min) / (max - min) end
							percent = math.clamp(percent, 0, 1)
							if precise then
								value = value or tonumber(string.format("%.1f", tostring(min + (max - min) * percent)))
							else
								value = value or math.floor(min + (max - min) * percent)
							end
							library.flags[flag] = tonumber(value)
							SliderValue.Text = tostring(value)
							Tween(SliderPart, 0.1, "Linear", "Out", {Size = UDim2.new(percent, 0, 1, 0)})
							callback(tonumber(value))
						end,
					}
					
					MinSlider.MouseButton1Click:Connect(function()
						local currentValue = library.flags[flag]
						currentValue = math.clamp(currentValue - 1, min, max)
						funcs:SetValue(currentValue)
					end)
					
					AddSlider.MouseButton1Click:Connect(function()
						local currentValue = library.flags[flag]
						currentValue = math.clamp(currentValue + 1, min, max)
						funcs:SetValue(currentValue)
					end)
					
					funcs:SetValue(default)
					
					local dragging = false
					
					SliderBar.InputBegan:Connect(function(input)
						if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
							dragging = true
							funcs:SetValue()
						end
					end)
					
					UserInputService.InputEnded:Connect(function(input)
						if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) and dragging then
							dragging = false
						end
					end)
					
					UserInputService.InputChanged:Connect(function(input)
						if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
							funcs:SetValue()
						end
					end)
					
					local boxFocused = false
					SliderValue.Focused:Connect(function() boxFocused = true end)
					SliderValue.FocusLost:Connect(function()
						boxFocused = false
						if SliderValue.Text == "" then funcs:SetValue(default) end
					end)
					
					SliderValue:GetPropertyChangedSignal("Text"):Connect(function()
						if not boxFocused then return end
						SliderValue.Text = SliderValue.Text:gsub("%D+", "")
						local text = SliderValue.Text
						if not tonumber(text) then
							SliderValue.Text = SliderValue.Text:gsub("%D+", "")
						elseif text ~= "" then
							if tonumber(text) > max then
								text = max
								SliderValue.Text = tostring(max)
							end
							funcs:SetValue(tonumber(text))
						end
					end)
					
					return funcs
				end
				
				function section.Dropdown(section, text, flag, options, callback)
					local callback = callback or function() end
					local options = options or {}
					library.flags[flag] = nil
					table.insert(tabInfo.searchableComponents, text)
					table.insert(sectionInfo.components, text)
					
					local DropdownModule = Instance.new("Frame")
					DropdownModule.Name = "DropdownModule"
					DropdownModule.Parent = Objs
					DropdownModule.BackgroundTransparency = 1
					DropdownModule.ClipsDescendants = true
					DropdownModule.Size = UDim2.new(1, 0, 0, 40 * scaleFactor)
					
					local DropdownTop = Instance.new("TextButton")
					DropdownTop.Name = "DropdownTop"
					DropdownTop.Parent = DropdownModule
					DropdownTop.BackgroundColor3 = Colors.Secondary
					DropdownTop.BackgroundTransparency = 0.3
					DropdownTop.Size = UDim2.new(1, 0, 0, 40 * scaleFactor)
					DropdownTop.AutoButtonColor = false
					DropdownTop.Font = Enum.Font.GothamSemibold
					DropdownTop.Text = ""
					DropdownTop.TextXAlignment = Enum.TextXAlignment.Left
					
					local DropdownTopC = Instance.new("UICorner")
					DropdownTopC.CornerRadius = UDim.new(0, 6)
					DropdownTopC.Parent = DropdownTop
					
					local DropdownText = Instance.new("TextBox")
					DropdownText.Name = "DropdownText"
					DropdownText.Parent = DropdownTop
					DropdownText.BackgroundTransparency = 1
					DropdownText.Position = UDim2.new(0, 40 * scaleFactor, 0, 0)
					DropdownText.Size = UDim2.new(1, -70 * scaleFactor, 1, 0)
					DropdownText.Font = Enum.Font.GothamSemibold
					DropdownText.PlaceholderText = text
					DropdownText.Text = ""
					DropdownText.TextColor3 = Colors.Text
					DropdownText.TextSize = 15 * scaleFactor
					DropdownText.TextXAlignment = Enum.TextXAlignment.Left
					DropdownText.ClearTextOnFocus = true
					
					local DropdownOpen = Instance.new("TextButton")
					DropdownOpen.Name = "DropdownOpen"
					DropdownOpen.Parent = DropdownTop
					DropdownOpen.AnchorPoint = Vector2.new(0, 0.5)
					DropdownOpen.BackgroundTransparency = 1
					DropdownOpen.Position = UDim2.new(1, -30 * scaleFactor, 0.5, 0)
					DropdownOpen.Size = UDim2.new(0, 20 * scaleFactor, 0, 20 * scaleFactor)
					DropdownOpen.Font = Enum.Font.GothamBold
					DropdownOpen.Text = "+"
					DropdownOpen.TextColor3 = Colors.Text
					DropdownOpen.TextSize = 20 * scaleFactor
					
					local DropdownModuleL = Instance.new("UIListLayout")
					DropdownModuleL.Name = "DropdownModuleL"
					DropdownModuleL.Parent = DropdownModule
					DropdownModuleL.SortOrder = Enum.SortOrder.LayoutOrder
					DropdownModuleL.Padding = UDim.new(0, 4)
					
					local open = false
					local funcs = {
						AddOption = function(self, option)
							table.insert(sectionInfo.components, option)
							local Option = Instance.new("TextButton")
							Option.Name = "Option_" .. option
							Option.Parent = DropdownModule
							Option.BackgroundColor3 = Colors.Secondary
							Option.BackgroundTransparency = 0.3
							Option.Size = UDim2.new(1, 0, 0, 32 * scaleFactor)
							Option.AutoButtonColor = false
							Option.Font = Enum.Font.Gotham
							Option.Text = option
							Option.TextColor3 = Colors.Text
							Option.TextSize = 14 * scaleFactor
							
							local OptionC = Instance.new("UICorner")
							OptionC.CornerRadius = UDim.new(0, 6)
							OptionC.Parent = Option
							
							Option.MouseButton1Click:Connect(function()
								open = false
								DropdownOpen.Text = "+"
								Tween(DropdownModule, 0.2, "Sine", "Out", {Size = UDim2.new(1, 0, 0, 40 * scaleFactor)})
								callback(Option.Text)
								DropdownText.Text = Option.Text
								library.flags[flag] = Option.Text
							end)
						end,
						
						RemoveOption = function(self, option)
							local option = DropdownModule:FindFirstChild("Option_" .. option)
							if option then option:Destroy() end
						end,
						
						SetOptions = function(self, options)
							if not options or typeof(options) ~= "table" then return end
							for _, v in next, DropdownModule:GetChildren() do
								if v.Name:match("Option_") then v:Destroy() end
							end
							for _, v in next, options do self:AddOption(v) end
						end,
						
						ToggleDropVis = function()
							open = not open
							DropdownOpen.Text = (open and "-" or "+")
							Tween(DropdownModule, 0.2, "Sine", "Out", {
								Size = UDim2.new(1, 0, 0, (open and DropdownModuleL.AbsoluteContentSize.Y + 4 or 40) * scaleFactor)
							})
						end
					}
					
					DropdownOpen.MouseButton1Click:Connect(function() funcs:ToggleDropVis() end)
					
					DropdownModuleL:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
						if open then
							Tween(DropdownModule, 0.2, "Sine", "Out", {Size = UDim2.new(1, 0, 0, (DropdownModuleL.AbsoluteContentSize.Y + 4) * scaleFactor)})
						end
					end)
					
					funcs:SetOptions(options)
					return funcs
				end
				
				section.TextBox = section.Textbox
				section.textbox = section.Textbox
				section.KeyBind = section.Keybind
				section.keybind = section.Keybind
				
				return section
			end
			
			return tab
		end
	}
	
	return window
end

return library
