repeat
	task.wait()
until game:IsLoaded()

local library = {}
local toggled = false
library.currentTab = nil
library.flags = {}

local configPath = "BSËÑöÊú¨/UIÈÖçÁΩÆ.txt"
local colorConfigPath = "BSËÑöÊú¨/È¢úËâ≤ÈÖçÁΩÆ.txt"

local function getCurrentConfig()
    local config = {
        autoFitScreen = false,
        windowSize = {650, 400},
        windowPosition = {0.5, 0.5},
        accentColor = {Colors and Colors.Accent and math.floor(Colors.Accent.R * 255) or 52,
                       Colors and Colors.Accent and math.floor(Colors.Accent.G * 255) or 152,
                       Colors and Colors.Accent and math.floor(Colors.Accent.B * 255) or 219},
        transparency = Colors and Colors.Transparent or 0.5,
        scaleFactor = 1,
        uiFollowEnabled = true,
        dragModeEnabled = false,
        faceCharacterEnabled = false,
        aiPanelEnabled = false,
        fontSize = "default",
        buttonStyle = "default",
        animationSpeed = "normal",
        flags = {}
    }
    
    for k, v in pairs(library.flags) do
        config.flags[k] = v
    end
    
    return config
end

local function saveConfig(config)
	local success, encoded = pcall(function()
		return game:GetService("HttpService"):JSONEncode(config)
	end)
	if success then
		if isfolder("BSËÑöÊú¨") then
			if isfile(configPath) then
				delfile(configPath)
			end
		else
			makefolder("BSËÑöÊú¨")
		end
		writefile(configPath, encoded)
		return true
	end
	return false
end

local function loadConfig()
	if isfile(configPath) then
		local success, config = pcall(function()
			return game:GetService("HttpService"):JSONDecode(readfile(configPath))
		end)
		if success then
			return config
		end
	end
	return getCurrentConfig()
end

local function saveColorConfig(colorConfig)
	local success, encoded = pcall(function()
		return game:GetService("HttpService"):JSONEncode(colorConfig)
	end)
	if success then
		if not isfolder("BSËÑöÊú¨") then
			makefolder("BSËÑöÊú¨")
		end
		writefile(colorConfigPath, encoded)
	end
end

local function loadColorConfig()
	if isfile(colorConfigPath) then
		local success, colorConfig = pcall(function()
			return game:GetService("HttpService"):JSONDecode(readfile(colorConfigPath))
		end)
		if success and colorConfig.accentColor then
			return Color3.fromRGB(unpack(colorConfig.accentColor))
		end
	end
	return Color3.fromRGB(52, 152, 219)
end

local services = setmetatable({}, {
	__index = function(t, k)
		return game.GetService(game, k)
	end,
})
local mouse = services.Players.LocalPlayer:GetMouse()

local Colors = {
	Primary = Color3.fromRGB(15, 15, 15),
	Secondary = Color3.fromRGB(30, 30, 30),
	Accent = Color3.fromRGB(52, 152, 219),
	Text = Color3.fromRGB(240, 240, 240),
	Placeholder = Color3.fromRGB(150, 150, 150),
	White = Color3.fromRGB(255, 255, 255),
	Transparent = 0.5,
	DefaultAccent = Color3.fromRGB(52, 152, 219)
}

local API_KEY = "sk-nfuceahepqtmwnqxhmermrnrjiipmnntpqljryhfzolhmjqd"
local MODEL = "deepseek-ai/DeepSeek-V3.2"

local function CreateGlassEffect(instance, transparency)
	instance.BackgroundTransparency = transparency or Colors.Transparent
	if not instance:FindFirstChild("GlassEffect") then
		local blur = Instance.new("ImageLabel")
		blur.Name = "GlassEffect"
		blur.BackgroundTransparency = 1
		blur.Size = UDim2.new(1, 0, 1, 0)
		blur.Image = "rbxassetid://5554237735"
		blur.ImageTransparency = 0.95
		blur.Parent = instance
	end
end

function Tween(obj, duration, style, direction, data)
	services.TweenService
		:Create(obj, TweenInfo.new(duration, Enum.EasingStyle[style], Enum.EasingDirection[direction]), data)
		:Play()
	return true
end

function Ripple(obj)
	spawn(function()
		if obj.ClipsDescendants ~= true then
			obj.ClipsDescendants = true
		end
		local Ripple = Instance.new("ImageLabel")
		Ripple.Name = "Ripple"
		Ripple.Parent = obj
		Ripple.BackgroundColor3 = Colors.White
		Ripple.BackgroundTransparency = 1.000
		Ripple.ZIndex = 8
		Ripple.Image = "rbxassetid://2708891598"
		Ripple.ImageTransparency = 0.800
		Ripple.ScaleType = Enum.ScaleType.Fit
		Ripple.ImageColor3 = Colors.White
		Ripple.Position = UDim2.new(
			(mouse.X - Ripple.AbsolutePosition.X) / obj.AbsoluteSize.X,
			0,
			(mouse.Y - Ripple.AbsolutePosition.Y) / obj.AbsoluteSize.Y,
			0
		)
		Tween(Ripple, 0.3, "Linear", "InOut", { Position = UDim2.new(-5.5, 0, -5.5, 0), Size = UDim2.new(12, 0, 12, 0) })
		wait(0.15)
		Tween(Ripple, 0.3, "Linear", "InOut", { ImageTransparency = 1 })
		wait(0.3)
		Ripple:Destroy()
	end)
end

local function autoFitUIScreen(mainFrame)
	local viewportSize = services.Workspace.CurrentCamera.ViewportSize
	
	if viewportSize.X < 800 then
		mainFrame.Size = UDim2.new(0, viewportSize.X - 100, 0, viewportSize.Y - 100)
	elseif viewportSize.Y < 600 then
		mainFrame.Size = UDim2.new(0, 550, 0, viewportSize.Y - 100)
	else
		mainFrame.Size = UDim2.new(0, 650, 0, 400)
	end
	
	mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
end

function drag(frame, hold)
	if not hold then
		hold = frame
	end
	local dragging
	local dragInput
	local dragStart
	local startPos
	local function update(input)
		local delta = input.Position - dragStart
		frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
	end
	hold.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = frame.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)
	frame.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement then
			dragInput = input
		end
	end)
	services.UserInputService.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			update(input)
		end
	end)
end

local function highlightText(originalText, searchTerm, color)
	if searchTerm == "" or not originalText:lower():find(searchTerm:lower(), 1, true) then
		return originalText
	end
	
	local pattern = searchTerm:gsub("([%^%$%(%)%%%.%[%]%*%+%-%?])", "%%%1")
	local highlighted = originalText:gsub("(" .. pattern .. ")", 
		'<font color="#4A90E2"><b>%1</b></font>')
	return highlighted
end

function library.new(library, name, theme)
	for _, v in next, services.CoreGui:GetChildren() do
		if v.Name == "REN" then
			v:Destroy()
		end
	end

	local camera = services.Workspace.CurrentCamera
	local player = services.Players.LocalPlayer
	local mouse = player:GetMouse()

	local canvasPart = Instance.new("Part")
	canvasPart.Name = "UI_Canvas_" .. game:GetService("HttpService"):GenerateGUID(false)
	canvasPart.Anchored = true
	canvasPart.CanCollide = false
	canvasPart.Transparency = 1
	canvasPart.Size = Vector3.new(15, 8.5, 0.2)
	canvasPart.Parent = workspace

	if syn and syn.protect_gui then
		syn.protect_gui(canvasPart)
	end

	local dogent = Instance.new("SurfaceGui")
	dogent.Name = "REN_3D"
	dogent.Adornee = canvasPart
	dogent.Face = Enum.NormalId.Back
	dogent.SizingMode = Enum.SurfaceGuiSizingMode.PixelsPerStud
	dogent.PixelsPerStud = 50
	dogent.AlwaysOnTop = true
	dogent.Parent = canvasPart

	if syn and syn.protect_gui then
		syn.protect_gui(dogent)
	end

	local switchGui = Instance.new("ScreenGui")
	switchGui.Name = "UI_Switch"
	switchGui.Parent = services.CoreGui

	if syn and syn.protect_gui then
		syn.protect_gui(switchGui)
	end

	local Open = Instance.new("TextButton")
	Open.Name = "Open"
	Open.Parent = switchGui
	Open.BackgroundColor3 = Colors.Primary
	Open.BackgroundTransparency = Colors.Transparent
	Open.Position = UDim2.new(0.01, 0, 0.3, 0)
	Open.Size = UDim2.new(0, 70, 0, 35)
	Open.Font = Enum.Font.GothamBold
	Open.Text = "BS"
	Open.TextColor3 = Colors.Text
	Open.TextSize = 14
	Open.Active = true
	Open.Draggable = true
	Open.ZIndex = 100
	
	local OpenC = Instance.new("UICorner")
	OpenC.CornerRadius = UDim.new(0, 6)
	OpenC.Parent = Open
	
	CreateGlassEffect(Open)
	
	local OpenStroke = Instance.new("UIStroke")
	OpenStroke.Color = Colors.Secondary
	OpenStroke.Thickness = 1
	OpenStroke.Transparency = 0.5
	OpenStroke.Parent = Open

	local isComputer = not services.UserInputService.TouchEnabled
	local scaleFactor = isComputer and 1.3 or 1

	Colors.Accent = loadColorConfig()

	local Main = Instance.new("Frame")
	Main.Name = "Main"
	Main.Parent = dogent
	Main.AnchorPoint = Vector2.new(0.5, 0.5)
	Main.BackgroundColor3 = Colors.Primary
	Main.BackgroundTransparency = 0
	Main.Size = UDim2.new(0, 650 * scaleFactor, 0, 400 * scaleFactor)
	Main.Position = UDim2.new(0.5, 0, 0.5, 0)
	Main.ZIndex = 1

	CreateGlassEffect(Main)
	
	local MainBG = Instance.new("ImageLabel")
	MainBG.Name = "MainBG"
	MainBG.Parent = Main
	MainBG.BackgroundTransparency = 1
	MainBG.Size = UDim2.new(1, 0, 1, 0)
	MainBG.Image = "rbxassetid://102621341311637"
	MainBG.ZIndex = 0
	MainBG.ImageTransparency = 0.2
	
	local MainC = Instance.new("UICorner")
	MainC.CornerRadius = UDim.new(0, 8)
	MainC.Parent = Main
	
	local MainStroke = Instance.new("UIStroke")
	MainStroke.Color = Colors.Secondary
	MainStroke.Thickness = 1
	MainStroke.Transparency = 0.5
	MainStroke.Parent = Main
	
	local DropShadowHolder = Instance.new("Frame")
	DropShadowHolder.Name = "DropShadowHolder"
	DropShadowHolder.Parent = Main
	DropShadowHolder.BackgroundTransparency = 1.000
	DropShadowHolder.Size = UDim2.new(1, 0, 1, 0)
	DropShadowHolder.ZIndex = 0
	
	local DropShadow = Instance.new("ImageLabel")
	DropShadow.Name = "DropShadow"
	DropShadow.Parent = DropShadowHolder
	DropShadow.AnchorPoint = Vector2.new(0.5, 0.5)
	DropShadow.BackgroundTransparency = 1.000
	DropShadow.Position = UDim2.new(0.5, 0, 0.5, 0)
	DropShadow.Size = UDim2.new(1, 47, 1, 47)
	DropShadow.ZIndex = 0
	DropShadow.Image = "rbxassetid://6015897843"
	DropShadow.ImageColor3 = Colors.Primary
	DropShadow.ImageTransparency = 0.7
	DropShadow.ScaleType = Enum.ScaleType.Slice
	DropShadow.SliceCenter = Rect.new(49, 49, 450, 450)
	
	local FaceBtn = Instance.new("ImageButton")
	FaceBtn.Name = "FaceBtn"
	FaceBtn.Parent = Main
	FaceBtn.BackgroundColor3 = Colors.Secondary
	FaceBtn.BackgroundTransparency = Colors.Transparent
	FaceBtn.Position = UDim2.new(1, -125, 0, 10)
	FaceBtn.Size = UDim2.new(0, 25, 0, 25)
	FaceBtn.Image = "rbxassetid://3926305904"
	FaceBtn.ImageRectOffset = Vector2.new(644, 124)
	FaceBtn.ImageRectSize = Vector2.new(36, 36)
	FaceBtn.ImageColor3 = Colors.Text
	FaceBtn.ZIndex = 10

	local FaceBtnC = Instance.new("UICorner")
	FaceBtnC.CornerRadius = UDim.new(0, 6)
	FaceBtnC.Parent = FaceBtn

	CreateGlassEffect(FaceBtn)

	local DragModeBtn = Instance.new("ImageButton")
	DragModeBtn.Name = "DragModeBtn"
	DragModeBtn.Parent = Main
	DragModeBtn.BackgroundColor3 = Colors.Secondary
	DragModeBtn.BackgroundTransparency = Colors.Transparent
	DragModeBtn.Position = UDim2.new(1, -95, 0, 10)
	DragModeBtn.Size = UDim2.new(0, 25, 0, 25)
	DragModeBtn.Image = "rbxassetid://3926305904"
	DragModeBtn.ImageRectOffset = Vector2.new(564, 444)
	DragModeBtn.ImageRectSize = Vector2.new(36, 36)
	DragModeBtn.ImageColor3 = Colors.Text
	DragModeBtn.ZIndex = 10

	local DragModeBtnC = Instance.new("UICorner")
	DragModeBtnC.CornerRadius = UDim.new(0, 6)
	DragModeBtnC.Parent = DragModeBtn

	CreateGlassEffect(DragModeBtn)

	local AIPanelBtn = Instance.new("ImageButton")
	AIPanelBtn.Name = "AIPanelBtn"
	AIPanelBtn.Parent = Main
	AIPanelBtn.BackgroundColor3 = Colors.Secondary
	AIPanelBtn.BackgroundTransparency = Colors.Transparent
	AIPanelBtn.Position = UDim2.new(1, -65, 0, 10)
	AIPanelBtn.Size = UDim2.new(0, 25, 0, 25)
	AIPanelBtn.Image = "rbxassetid://3926305904"
	AIPanelBtn.ImageRectOffset = Vector2.new(484, 444)
	AIPanelBtn.ImageRectSize = Vector2.new(36, 36)
	AIPanelBtn.ImageColor3 = Colors.Text
	AIPanelBtn.ZIndex = 10

	local AIPanelBtnC = Instance.new("UICorner")
	AIPanelBtnC.CornerRadius = UDim.new(0, 6)
	AIPanelBtnC.Parent = AIPanelBtn

	CreateGlassEffect(AIPanelBtn)

	local AutoFitBtn = Instance.new("ImageButton")
	AutoFitBtn.Name = "AutoFitBtn"
	AutoFitBtn.Parent = Main
	AutoFitBtn.BackgroundColor3 = Colors.Secondary
	AutoFitBtn.BackgroundTransparency = Colors.Transparent
	AutoFitBtn.Position = UDim2.new(1, -155, 0, 10)
	AutoFitBtn.Size = UDim2.new(0, 25, 0, 25)
	AutoFitBtn.Image = "rbxassetid://3926305904"
	AutoFitBtn.ImageRectOffset = Vector2.new(244, 164)
	AutoFitBtn.ImageRectSize = Vector2.new(36, 36)
	AutoFitBtn.ImageColor3 = Colors.Text
	AutoFitBtn.ZIndex = 10
	
	local AutoFitBtnC = Instance.new("UICorner")
	AutoFitBtnC.CornerRadius = UDim.new(0, 6)
	AutoFitBtnC.Parent = AutoFitBtn
	
	CreateGlassEffect(AutoFitBtn)
	
	local ScaleBtn = Instance.new("ImageButton")
	ScaleBtn.Name = "ScaleBtn"
	ScaleBtn.Parent = Main
	ScaleBtn.BackgroundColor3 = Colors.Secondary
	ScaleBtn.BackgroundTransparency = Colors.Transparent
	ScaleBtn.Position = UDim2.new(1, -185, 0, 10)
	ScaleBtn.Size = UDim2.new(0, 25, 0, 25)
	ScaleBtn.Image = "rbxassetid://3926305904"
	ScaleBtn.ImageRectOffset = Vector2.new(324, 364)
	ScaleBtn.ImageRectSize = Vector2.new(36, 36)
	ScaleBtn.ImageColor3 = Colors.Text
	ScaleBtn.ZIndex = 10
	
	local ScaleBtnC = Instance.new("UICorner")
	ScaleBtnC.CornerRadius = UDim.new(0, 6)
	ScaleBtnC.Parent = ScaleBtn
	
	CreateGlassEffect(ScaleBtn)

	local AnimationsBtn = Instance.new("ImageButton")
	AnimationsBtn.Name = "AnimationsBtn"
	AnimationsBtn.Parent = Main
	AnimationsBtn.BackgroundColor3 = Colors.Secondary
	AnimationsBtn.BackgroundTransparency = Colors.Transparent
	AnimationsBtn.Position = UDim2.new(1, -35, 0, 10)
	AnimationsBtn.Size = UDim2.new(0, 25, 0, 25)
	AnimationsBtn.Image = "rbxassetid://3926305904"
	AnimationsBtn.ImageRectOffset = Vector2.new(724, 204)
	AnimationsBtn.ImageRectSize = Vector2.new(36, 36)
	AnimationsBtn.ImageColor3 = Colors.Text
	AnimationsBtn.ZIndex = 10
	
	local AnimationsBtnC = Instance.new("UICorner")
	AnimationsBtnC.CornerRadius = UDim.new(0, 6)
	AnimationsBtnC.Parent = AnimationsBtn
	
	CreateGlassEffect(AnimationsBtn)
	
	local CloseBtn = Instance.new("TextButton")
	CloseBtn.Name = "CloseBtn"
	CloseBtn.Parent = Main
	CloseBtn.BackgroundColor3 = Colors.Secondary
	CloseBtn.BackgroundTransparency = Colors.Transparent
	CloseBtn.Position = UDim2.new(1, -35, 0, 10)
	CloseBtn.Size = UDim2.new(0, 25, 0, 25)
	CloseBtn.Font = Enum.Font.GothamBold
	CloseBtn.Text = "‚úï"
	CloseBtn.TextColor3 = Colors.Text
	CloseBtn.TextSize = 20
	CloseBtn.ZIndex = 10
	
	local CloseBtnC = Instance.new("UICorner")
	CloseBtnC.CornerRadius = UDim.new(0, 6)
	CloseBtnC.Parent = CloseBtn

	local AIPanelFrame = Instance.new("Frame")
	AIPanelFrame.Name = "AIPanelFrame"
	AIPanelFrame.Parent = Main
	AIPanelFrame.BackgroundColor3 = Colors.Secondary
	AIPanelFrame.BackgroundTransparency = Colors.Transparent
	AIPanelFrame.Position = UDim2.new(0, 0, 0, 100)
	AIPanelFrame.Size = UDim2.new(1, 0, 1, -100)
	AIPanelFrame.Visible = false
	AIPanelFrame.ZIndex = 15

	local AIPanelC = Instance.new("UICorner")
	AIPanelC.CornerRadius = UDim.new(0, 8)
	AIPanelC.Parent = AIPanelFrame

	CreateGlassEffect(AIPanelFrame)

	local AIPanelTitle = Instance.new("TextLabel")
	AIPanelTitle.Name = "AIPanelTitle"
	AIPanelTitle.Parent = AIPanelFrame
	AIPanelTitle.BackgroundTransparency = 1
	AIPanelTitle.Position = UDim2.new(0, 15, 0, 15)
	AIPanelTitle.Size = UDim2.new(1, -30, 0, 30)
	AIPanelTitle.Font = Enum.Font.GothamBlack
	AIPanelTitle.Text = "AI Âä©Êâã - ÁÇπÂáªÂè≥‰∏äËßíÊåâÈíÆËøîÂõû"
	AIPanelTitle.TextColor3 = Colors.Text
	AIPanelTitle.TextSize = 18
	AIPanelTitle.TextXAlignment = Enum.TextXAlignment.Left
	AIPanelTitle.ZIndex = 16

	local AIPanelTopBar = Instance.new("Frame")
	AIPanelTopBar.Name = "AIPanelTopBar"
	AIPanelTopBar.Parent = AIPanelFrame
	AIPanelTopBar.BackgroundTransparency = 1
	AIPanelTopBar.Position = UDim2.new(0, 15, 0, 55)
	AIPanelTopBar.Size = UDim2.new(1, -30, 0, 30)
	AIPanelTopBar.ZIndex = 16

	local ModeToggleBtn = Instance.new("TextButton")
	ModeToggleBtn.Name = "ModeToggleBtn"
	ModeToggleBtn.Parent = AIPanelTopBar
	ModeToggleBtn.BackgroundColor3 = Colors.Accent
	ModeToggleBtn.BackgroundTransparency = 0.2
	ModeToggleBtn.Size = UDim2.new(0, 120, 1, 0)
	ModeToggleBtn.Font = Enum.Font.GothamSemibold
	ModeToggleBtn.Text = "Ëá™ÂÆö‰πâÊåá‰ª§Ê®°Âºè"
	ModeToggleBtn.TextColor3 = Colors.Text
	ModeToggleBtn.TextSize = 14
	ModeToggleBtn.ZIndex = 17

	local ModeToggleBtnC = Instance.new("UICorner")
	ModeToggleBtnC.CornerRadius = UDim.new(0, 6)
	ModeToggleBtnC.Parent = ModeToggleBtn

	local ChatHistory = Instance.new("ScrollingFrame")
	ChatHistory.Name = "ChatHistory"
	ChatHistory.Parent = AIPanelFrame
	ChatHistory.BackgroundTransparency = 1
	ChatHistory.Position = UDim2.new(0, 15, 0, 90)
	ChatHistory.Size = UDim2.new(1, -30, 1, -140)
	ChatHistory.CanvasSize = UDim2.new(0, 0, 0, 0)
	ChatHistory.ScrollBarThickness = 2
	ChatHistory.ZIndex = 16

	local ChatHistoryL = Instance.new("UIListLayout")
	ChatHistoryL.Parent = ChatHistory
	ChatHistoryL.SortOrder = Enum.SortOrder.LayoutOrder
	ChatHistoryL.Padding = UDim.new(0, 10)

	local InputFrame = Instance.new("Frame")
	InputFrame.Name = "InputFrame"
	InputFrame.Parent = AIPanelFrame
	InputFrame.BackgroundColor3 = Colors.Primary
	InputFrame.BackgroundTransparency = 0.5
	InputFrame.Position = UDim2.new(0, 15, 1, -45)
	InputFrame.Size = UDim2.new(1, -110, 0, 35)
	InputFrame.ZIndex = 16

	local InputFrameC = Instance.new("UICorner")
	InputFrameC.CornerRadius = UDim.new(0, 6)
	InputFrameC.Parent = InputFrame

	local AIInput = Instance.new("TextBox")
	AIInput.Name = "AIInput"
	AIInput.Parent = InputFrame
	AIInput.BackgroundTransparency = 1
	AIInput.Size = UDim2.new(1, -10, 1, 0)
	AIInput.Position = UDim2.new(0, 5, 0, 0)
	AIInput.Font = Enum.Font.Gotham
	AIInput.PlaceholderText = "ËæìÂÖ•Êåá‰ª§,‰æãÂ¶Ç: Êää‰∏ªÈ¢òÊîπÊàêÁ∫¢Ëâ≤"
	AIInput.Text = ""
	AIInput.TextColor3 = Colors.Text
	AIInput.TextSize = 14
	AIInput.ClearTextOnFocus = false
	AIInput.ZIndex = 17

	local AISendBtn = Instance.new("TextButton")
	AISendBtn.Name = "AISendBtn"
	AISendBtn.Parent = AIPanelFrame
	AISendBtn.BackgroundColor3 = Colors.Accent
	AISendBtn.BackgroundTransparency = 0.2
	AISendBtn.Position = UDim2.new(1, -85, 1, -45)
	AISendBtn.Size = UDim2.new(0, 70, 0, 35)
	AISendBtn.Font = Enum.Font.GothamBold
	AISendBtn.Text = "ÂèëÈÄÅ"
	AISendBtn.TextColor3 = Colors.Text
	AISendBtn.TextSize = 16
	AISendBtn.ZIndex = 16

	local AISendBtnC = Instance.new("UICorner")
	AISendBtnC.CornerRadius = UDim.new(0, 6)
	AISendBtnC.Parent = AISendBtn

	local LoadingLabel = Instance.new("TextLabel")
	LoadingLabel.Name = "LoadingLabel"
	LoadingLabel.Parent = AIPanelFrame
	LoadingLabel.BackgroundTransparency = 1
	LoadingLabel.Position = UDim2.new(0.5, 0, 0.5, 0)
	LoadingLabel.Size = UDim2.new(0, 200, 0, 30)
	LoadingLabel.Font = Enum.Font.GothamSemibold
	LoadingLabel.Text = "AI ÊÄùËÄÉ‰∏≠..."
	LoadingLabel.TextColor3 = Colors.Text
	LoadingLabel.TextSize = 16
	LoadingLabel.Visible = false
	LoadingLabel.ZIndex = 18

    local isFirstTimeAI = true
	local aiMode = "custom"

	local function addChatMessage(text, isUser)
		local messageFrame = Instance.new("Frame")
		messageFrame.Parent = ChatHistory
		messageFrame.BackgroundTransparency = 1
		messageFrame.Size = UDim2.new(1, 0, 0, 0)
		messageFrame.ZIndex = 17
		
		if isUser then
			messageFrame.AnchorPoint = Vector2.new(1, 0)
			messageFrame.Position = UDim2.new(1, -10, 0, 0)
			messageFrame.Size = UDim2.new(0.8, 0, 0, 0)
		else
			messageFrame.AnchorPoint = Vector2.new(0, 0)
			messageFrame.Position = UDim2.new(0, 10, 0, 0)
			messageFrame.Size = UDim2.new(0.8, 0, 0, 0)
		end
		
		local messageLabel = Instance.new("TextLabel")
		messageLabel.Parent = messageFrame
		messageLabel.BackgroundColor3 = isUser and Colors.Accent or Colors.Secondary
		messageLabel.BackgroundTransparency = 0.3
		messageLabel.Size = UDim2.new(1, 0, 0, 0)
		messageLabel.Font = Enum.Font.Gotham
		messageLabel.TextSize = 14
		messageLabel.TextWrapped = true
		messageLabel.RichText = true
		messageLabel.TextXAlignment = Enum.TextXAlignment.Left
		messageLabel.TextColor3 = Colors.Text
		messageLabel.Text = isUser and ("‰Ω†: " .. text) or ("AI: " .. text)
		messageLabel.ZIndex = 17
		
		local corner = Instance.new("UICorner")
		corner.CornerRadius = UDim.new(0, 8)
		corner.Parent = messageLabel
		
		if isUser then
			messageLabel.AnchorPoint = Vector2.new(1, 0)
			messageLabel.Position = UDim2.new(1, 0, 0, 0)
		end
		
		messageLabel:GetPropertyChangedSignal("TextBounds"):Connect(function()
			local textHeight = messageLabel.TextBounds.Y + 20
			messageFrame.Size = UDim2.new(0.8, 0, 0, textHeight)
			messageLabel.Size = UDim2.new(1, 0, 0, textHeight - 10)
			ChatHistory.CanvasSize = UDim2.new(0, 0, 0, ChatHistoryL.AbsoluteContentSize.Y + 20)
		end)
	end

    local function copyConfigToClipboard()
        local config = getCurrentConfig()
        local success, json = pcall(function()
            return game:GetService("HttpService"):JSONEncode(config, true)
        end)
        
        if success then
            local clipboardGui = Instance.new("ScreenGui")
            clipboardGui.Name = "ConfigClipboard"
            clipboardGui.Parent = services.CoreGui
            
            local textBox = Instance.new("TextBox")
            textBox.Size = UDim2.new(0, 400, 0, 300)
            textBox.Position = UDim2.new(0.5, -200, 0.5, -150)
            textBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
            textBox.TextColor3 = Color3.fromRGB(240, 240, 240)
            textBox.TextSize = 12
            textBox.Font = Enum.Font.Code
            textBox.Text = json
            textBox.MultiLine = true
            textBox.ClearTextOnFocus = false
            textBox.Parent = clipboardGui
            
            local corner = Instance.new("UICorner")
            corner.CornerRadius = UDim.new(0, 8)
            corner.Parent = textBox
            
            local stroke = Instance.new("UIStroke")
            stroke.Color = Color3.fromRGB(52, 152, 219)
            stroke.Thickness = 2
            stroke.Parent = textBox
            
            addChatMessage("ÈÖçÁΩÆÂ∑≤ÁîüÊàêÔºÅËØ∑Âú®‰∏ãÊñπÊñáÊú¨Ê°Ü‰∏≠ÂÖ®ÈÄâÂπ∂Â§çÂà∂ÈÖçÁΩÆÔºö", false)
            addChatMessage(json, false)
            
            spawn(function()
                wait(3)
                clipboardGui:Destroy()
            end)
            
            return true
        end
        return false
    end

    local function applyFullConfig(config)
        if not config or type(config) ~= "table" then
            return false
        end
        
        if config.accentColor then
            local r, g, b = unpack(config.accentColor)
            local newColor = Color3.fromRGB(r, g, b)
            Colors.Accent = newColor
            saveColorConfig({accentColor = config.accentColor})
            
            for _, obj in pairs(Main:GetDescendants()) do
                if obj:IsA("Frame") or obj:IsA("TextButton") or obj:IsA("ImageButton") then
                    if obj.BackgroundColor3 and obj.BackgroundColor3 == Colors.Accent then
                        Tween(obj, 0.3, "Sine", "Out", { BackgroundColor3 = newColor })
                    end
                end
                if obj:IsA("TextLabel") or obj:IsA("TextBox") or obj:IsA("TextButton") then
                    if obj.TextColor3 and obj.TextColor3 == Colors.Accent then
                        Tween(obj, 0.3, "Sine", "Out", { TextColor3 = newColor })
                    end
                end
                if obj:IsA("UIStroke") and obj.Color == Colors.Accent then
                    Tween(obj, 0.3, "Sine", "Out", { Color = newColor })
                end
                if obj:IsA("ImageLabel") or obj:IsA("ImageButton") then
                    if obj.ImageColor3 and obj.ImageColor3 == Colors.Accent then
                        Tween(obj, 0.3, "Sine", "Out", { ImageColor3 = newColor })
                    end
                end
            end
        end
        
        if config.transparency then
            Colors.Transparent = config.transparency
            for _, obj in pairs(Main:GetDescendants()) do
                if obj.Name == "GlassEffect" then
                    obj.ImageTransparency = 1 - config.transparency + 0.5
                end
            end
        end
        
        if config.fontSize then
            local sizeMap = {
                small = 12,
                default = 14,
                large = 16
            }
            local size = sizeMap[config.fontSize] or 14
            for _, obj in pairs(Main:GetDescendants()) do
                if obj:IsA("TextLabel") or obj:IsA("TextBox") or obj:IsA("TextButton") then
                    if obj.TextSize then
                        Tween(obj, 0.3, "Sine", "Out", { TextSize = size })
                    end
                end
            end
        end
        
        if config.buttonStyle then
            local radius = config.buttonStyle == "square" and UDim.new(0, 0) or 
                          config.buttonStyle == "rounded" and UDim.new(0, 12) or 
                          UDim.new(0, 6)
            for _, obj in pairs(Main:GetDescendants()) do
                if obj:IsA("Frame") or obj:IsA("TextButton") or obj:IsA("ImageButton") then
                    local corner = obj:FindFirstChildOfClass("UICorner")
                    if corner then
                        Tween(corner, 0.3, "Sine", "Out", { CornerRadius = radius })
                    end
                end
            end
        end
        
        if config.flags then
            for flag, value in pairs(config.flags) do
                library.flags[flag] = value
            end
        end
        
        if config.uiFollowEnabled ~= nil then
            uiFollowEnabled = config.uiFollowEnabled
        end
        if config.dragModeEnabled ~= nil then
            dragModeEnabled = config.dragModeEnabled
        end
        if config.faceCharacterEnabled ~= nil then
            faceCharacterEnabled = config.faceCharacterEnabled
        end
        
        return true
    end

    local function showAllCommands()
        addChatMessage("üéâ Ê¨¢Ëøé‰ΩøÁî®AIÂä©ÊâãÔºÅ‰ª•‰∏ãÊòØÊâÄÊúâÊîØÊåÅÁöÑÊåá‰ª§Ôºö", false)
        wait(0.1)
        addChatMessage("üé® È¢úËâ≤‰øÆÊîπÔºöÁ∫¢/Ëìù/Áªø/ÈªÑ/Á¥´/Ê©ô/Á≤â/Èùí/Èªë/ÁôΩ/ÁÅ∞/Èáë/Èì∂/ÈªòËÆ§, Êàñ #FF0000", false)
        wait(0.05)
        addChatMessage("üìê Â∏ÉÂ±ÄÈó¥Ë∑ùÔºöÁ¥ßÂáë/ÂÆΩÊùæ/ÈªòËÆ§", false)
        wait(0.05)
        addChatMessage("üíß ÈÄèÊòéÂ∫¶ÔºöÈ´ò/‰Ωé/ÈªòËÆ§", false)
        wait(0.05)
        addChatMessage("üìè UIÂ∞∫ÂØ∏ÔºöÂ§ß/Â∞è/ÈªòËÆ§", false)
        wait(0.05)
        addChatMessage("‚úèÔ∏è Â≠ó‰ΩìÂ§ßÂ∞èÔºöÂ≠ó‰ΩìÂ§ß/Â≠ó‰ΩìÂ∞è/Â≠ó‰ΩìÈªòËÆ§", false)
        wait(0.05)
        addChatMessage("üéØ ÊåâÈíÆÊ†∑ÂºèÔºöÂúÜËßí/ÊñπÂΩ¢/ÈªòËÆ§", false)
        wait(0.05)
        addChatMessage("‚ö° Âä®ÁîªÈÄüÂ∫¶ÔºöÂä®ÁîªÂø´/Âä®ÁîªÊÖ¢/Âä®ÁîªÂÖ≥Èó≠", false)
        wait(0.05)
        addChatMessage("üíæ ‰øùÂ≠òÈÖçÁΩÆÔºöÂèëÈÄÅ\"‰øùÂ≠ò\"Êàñ\"‰øùÂ≠òÈÖçÁΩÆ\"", false)
        wait(0.05)
        addChatMessage("üìã Â§çÂà∂ÈÖçÁΩÆÔºöÂèëÈÄÅ\"Â§çÂà∂ÈÖçÁΩÆ\"Êàñ\"Â§çÂà∂\"", false)
        wait(0.05)
        addChatMessage("üîÑ ÈáçÁΩÆUIÔºöÂèëÈÄÅ\"ÈáçÁΩÆ\"Êàñ\"ÊÅ¢Â§çÈªòËÆ§\"", false)
        wait(0.05)
        addChatMessage("üì± Â∫îÁî®JSONÔºöÁõ¥Êé•Á≤òË¥¥ÈÖçÁΩÆJSONÂç≥ÂèØ", false)
        wait(0.05)
        addChatMessage("üí° ÊèêÁ§∫Ôºö‰Ω†ÂèØ‰ª•ÁªÑÂêà‰ΩøÁî®Êåá‰ª§ÔºåÂ¶Ç\"ÊîπÊàêÁ∫¢Ëâ≤ÔºåÁ¥ßÂáëÂ∏ÉÂ±ÄÔºåÈÄèÊòéÂ∫¶‰Ωé\"", false)
    end

	local function parseAIResponse(response)
		local commands = {}
		local lower = response:lower()
		
		if lower:match("‰øùÂ≠ò") or lower:match("save config") then
			table.insert(commands, {type = "save", value = true})
		end
		
		if lower:match("Â§çÂà∂ÈÖçÁΩÆ") or lower:match("copy config") then
			table.insert(commands, {type = "copy", value = true})
		end
		
		if response:match("^%s*{") and response:match("}$") then
			table.insert(commands, {type = "apply_config", value = response})
		end
		
		local colorMap = {
			["Á∫¢"] = "#FF0000", ["red"] = "#FF0000",
			["Ëìù"] = "#0000FF", ["blue"] = "#0000FF",
			["Áªø"] = "#00FF00", ["green"] = "#00FF00",
			["ÈªÑ"] = "#FFFF00", ["yellow"] = "#FFFF00",
			["Á¥´"] = "#FF00FF", ["purple"] = "#FF00FF",
			["Èùí"] = "#00FFFF", ["cyan"] = "#00FFFF",
			["Èªë"] = "#000000", ["black"] = "#000000",
			["ÁôΩ"] = "#FFFFFF", ["white"] = "#FFFFFF",
			["Ê©ô"] = "#FFA500", ["orange"] = "#FFA500",
			["Á≤â"] = "#FFC0CB", ["pink"] = "#FFC0CB",
			["ÁÅ∞"] = "#808080", ["gray"] = "#808080", ["grey"] = "#808080",
			["Èì∂"] = "#C0C0C0", ["silver"] = "#C0C0C0",
			["Èáë"] = "#FFD700", ["gold"] = "#FFD700",
			["ÈªòËÆ§"] = "#3498DB", ["default"] = "#3498DB",
			["ÈöèÊú∫"] = "random", ["random"] = "random"
		}
		
		local hex = response:match("#%x%x%x%x%x%x")
		if hex then
			table.insert(commands, {type = "color", value = hex})
		else
			for name, hexCode in pairs(colorMap) do
				if lower:match(name) then
					table.insert(commands, {type = "color", value = hexCode})
					break
				end
			end
		end
		
		if lower:match("Â∏ÉÂ±Ä") or lower:match("layout") or lower:match("spacing") then
			if lower:match("Á¥ßÂáë") or lower:match("compact") or lower:match("tight") then
				table.insert(commands, {type = "spacing", value = "compact"})
			elseif lower:match("ÂÆΩÊùæ") or lower:match("spacious") or lower:match("wide") then
				table.insert(commands, {type = "spacing", value = "spacious"})
			elseif lower:match("ÈªòËÆ§") or lower:match("default") then
				table.insert(commands, {type = "spacing", value = "default"})
			end
		end
		
		if lower:match("ÈÄèÊòé") or lower:match("transparent") or lower:match("opacity") then
			if lower:match("È´ò") or lower:match("high") or lower:match("more") then
				table.insert(commands, {type = "transparency", value = 0.7})
			elseif lower:match("‰Ωé") or lower:match("low") or lower:match("less") then
				table.insert(commands, {type = "transparency", value = 0.2})
			elseif lower:match("ÈªòËÆ§") or lower:match("default") or lower:match("normal") then
				table.insert(commands, {type = "transparency", value = 0.5})
			end
		end
		
		if lower:match("Â§ßÂ∞è") or lower:match("size") or lower:match("Áº©Êîæ") then
			if lower:match("Â§ß") or lower:match("big") or lower:match("large") or lower:match("ÊîæÂ§ß") then
				table.insert(commands, {type = "size", value = "large"})
			elseif lower:match("Â∞è") or lower:match("small") or lower:match("mini") or lower:match("Áº©Â∞è") then
				table.insert(commands, {type = "size", value = "small"})
			elseif lower:match("ÈªòËÆ§") or lower:match("default") or lower:match("normal") then
				table.insert(commands, {type = "size", value = "default"})
			end
		end
		
		if lower:match("Â≠ó‰Ωì") or lower:match("font") or lower:match("ÊñáÂ≠ó") then
			if lower:match("Â§ß") or lower:match("big") or lower:match("large") then
				table.insert(commands, {type = "font", value = "large"})
			elseif lower:match("Â∞è") or lower:match("small") or lower:match("tiny") then
				table.insert(commands, {type = "font", value = "small"})
			elseif lower:match("ÈªòËÆ§") or lower:match("default") or lower:match("normal") then
				table.insert(commands, {type = "font", value = "default"})
			end
		end
		
		if lower:match("ÊåâÈíÆ") or lower:match("button") or lower:match("ÂúÜËßí") then
			if lower:match("ÂúÜËßí") or lower:match("rounded") or lower:match("circular") then
				table.insert(commands, {type = "buttonstyle", value = "rounded"})
			elseif lower:match("ÊñπÂΩ¢") or lower:match("square") or lower:match("sharp") then
				table.insert(commands, {type = "buttonstyle", value = "square"})
			elseif lower:match("ÈªòËÆ§") or lower:match("default") then
				table.insert(commands, {type = "buttonstyle", value = "default"})
			end
		end
		
		if lower:match("Âä®Áîª") or lower:match("animation") or lower:match("ÈÄüÂ∫¶") then
			if lower:match("Âø´") or lower:match("fast") or lower:match("quick") then
				table.insert(commands, {type = "animation", value = "fast"})
			elseif lower:match("ÊÖ¢") or lower:match("slow") or lower:match("gentle") then
				table.insert(commands, {type = "animation", value = "slow"})
			elseif lower:match("ÂÖ≥Èó≠") or lower:match("off") or lower:match("none") then
				table.insert(commands, {type = "animation", value = "none"})
			elseif lower:match("ÈªòËÆ§") or lower:match("default") or lower:match("normal") then
				table.insert(commands, {type = "animation", value = "normal"})
			end
		end
		
		if lower:match("ÈáçÁΩÆ") or lower:match("reset") or lower:match("ÊÅ¢Â§ç") or lower:match("ÈªòËÆ§") then
			table.insert(commands, {type = "reset", value = true})
		end
		
		if lower:match("Â∏ÆÂä©") or lower:match("help") or lower:match("Êåá‰ª§") or lower:match("commands") then
			table.insert(commands, {type = "help", value = true})
		end
		
		return commands
	end

    local function applyColorToAllUI(newColor)
        for _, obj in pairs(Main:GetDescendants()) do
            if obj:IsA("Frame") or obj:IsA("TextButton") or obj:IsA("ImageButton") then
                if obj.BackgroundColor3 == Colors.Accent then
                    Tween(obj, 0.3, "Sine", "Out", { BackgroundColor3 = newColor })
                end
            end
            
            if obj:IsA("TextLabel") or obj:IsA("TextBox") or obj:IsA("TextButton") then
                if obj.TextColor3 == Colors.Accent then
                    Tween(obj, 0.3, "Sine", "Out", { TextColor3 = newColor })
                end
            end
            
            if obj:IsA("UIStroke") then
                if obj.Color == Colors.Accent then
                    Tween(obj, 0.3, "Sine", "Out", { Color = newColor })
                end
            end
            
            if obj:IsA("ImageLabel") or obj:IsA("ImageButton") then
                if obj.ImageColor3 == Colors.Accent then
                    Tween(obj, 0.3, "Sine", "Out", { ImageColor3 = newColor })
                end
            end
        end
        
        local TitleGradient = Main:FindFirstChild("TitleBar"):FindFirstChild("ScriptTitle"):FindFirstChild("UIGradient")
        if TitleGradient then
            Tween(TitleGradient, 0.3, "Sine", "Out", { 
                Color = ColorSequence.new({
                    ColorSequenceKeypoint.new(0.00, newColor),
                    ColorSequenceKeypoint.new(0.50, newColor:Lerp(Color3.fromRGB(0,0,0), 0.2)),
                    ColorSequenceKeypoint.new(1.00, newColor:Lerp(Color3.fromRGB(0,0,0), 0.4)),
                })
            })
        end
        
        Colors.Accent = newColor
        saveColorConfig({accentColor = {math.floor(newColor.R*255), math.floor(newColor.G*255), math.floor(newColor.B*255)}})
    end

	local function applyCommands(commands)
		for _, cmd in ipairs(commands) do
			if cmd.type == "color" then
				local hex = cmd.value
                local newColor
				
                if hex == "random" then
                    newColor = Color3.fromRGB(math.random(0,255), math.random(0,255), math.random(0,255))
                    addChatMessage("üé® Â∑≤Â∫îÁî®ÈöèÊú∫È¢úËâ≤ÔºÅ", false)
                else
                    local r = tonumber(hex:sub(2, 3), 16) or 255
                    local g = tonumber(hex:sub(4, 5), 16) or 255
                    local b = tonumber(hex:sub(6, 7), 16) or 255
                    newColor = Color3.fromRGB(r, g, b)
                end
                
                applyColorToAllUI(newColor)
                addChatMessage("‰∏ªÈ¢òÈ¢úËâ≤Â∑≤‰øÆÊîπ‰∏∫ " .. (hex == "random" and "ÈöèÊú∫È¢úËâ≤" or hex), false)
			elseif cmd.type == "spacing" then
				local spacingValue = cmd.value == "compact" and UDim.new(0, 4) or 
									cmd.value == "spacious" and UDim.new(0, 15) or 
									UDim.new(0, 8)
				
				local modified = 0
				for _, layout in pairs(Main:GetDescendants()) do
					if layout:IsA("UIListLayout") then
						layout.Padding = spacingValue
						modified = modified + 1
					elseif layout:IsA("UIGridLayout") then
						layout.CellPadding = UDim2.new(0, 10, 0, 10)
						modified = modified + 1
					end
				end
				
				addChatMessage("Â∏ÉÂ±ÄÈó¥Ë∑ùÂ∑≤‰øÆÊîπ‰∏∫ " .. cmd.value .. " (ÂΩ±Âìç" .. modified .. "‰∏™ÂÖÉÁ¥†)", false)
			elseif cmd.type == "transparency" then
				local transparency = cmd.value
				Colors.Transparent = transparency
				
				local modified = 0
				for _, obj in pairs(Main:GetDescendants()) do
					if obj.Name == "GlassEffect" then
						obj.ImageTransparency = 1 - transparency + 0.5
						modified = modified + 1
					end
				end
				
				addChatMessage("ÈÄèÊòéÂ∫¶Â∑≤Ë∞ÉÊï¥‰∏∫ " .. string.format("%.1f", transparency) .. " (ÂΩ±Âìç" .. modified .. "‰∏™ÂÖÉÁ¥†)", false)
			elseif cmd.type == "size" then
				local currentScale = scaleFactor
				local newScale = cmd.value == "large" and 1.5 or cmd.value == "small" and 0.7 or 1.3
                
                scaleFactor = newScale
				Main.Size = UDim2.new(0, 650 * newScale, 0, 400 * newScale)
				Main.Position = UDim2.new(0.5, 0, 0.5, 0)
				
				addChatMessage("UIÂ∞∫ÂØ∏Â∑≤‰øÆÊîπ‰∏∫ " .. cmd.value .. " (Áº©Êîæ: " .. string.format("%.1f", newScale/currentScale) .. "ÂÄç)", false)
			elseif cmd.type == "font" then
				local sizeMap = {
					small = 12,
					default = 14,
					large = 16
				}
				local newSize = sizeMap[cmd.value] or 14
                local modified = 0
				
				for _, obj in pairs(Main:GetDescendants()) do
					if obj:IsA("TextLabel") or obj:IsA("TextBox") or obj:IsA("TextButton") then
						if obj.TextSize and obj.TextSize >= 12 and obj.TextSize <= 18 then
                            Tween(obj, 0.3, "Sine", "Out", { TextSize = newSize })
                            modified = modified + 1
                        end
					end
				end
				
				addChatMessage("Â≠ó‰ΩìÂ§ßÂ∞èÂ∑≤‰øÆÊîπ‰∏∫ " .. cmd.value .. " (ÂΩ±Âìç" .. modified .. "‰∏™ÊñáÊú¨ÂÖÉÁ¥†)", false)
			elseif cmd.type == "buttonstyle" then
				local radius = cmd.value == "square" and UDim.new(0, 0) or 
							  cmd.value == "rounded" and UDim.new(0, 12) or 
							  UDim.new(0, 6)
                local modified = 0
				
				for _, obj in pairs(Main:GetDescendants()) do
					if obj:IsA("Frame") or obj:IsA("TextButton") or obj:IsA("ImageButton") then
						local corner = obj:FindFirstChildOfClass("UICorner")
						if corner then
                            Tween(corner, 0.3, "Sine", "Out", { CornerRadius = radius })
                            modified = modified + 1
						end
					end
				end
				
				addChatMessage("ÊåâÈíÆÊ†∑ÂºèÂ∑≤‰øÆÊîπ‰∏∫ " .. cmd.value .. " (ÂΩ±Âìç" .. modified .. "‰∏™ÂÖÉÁ¥†)", false)
			elseif cmd.type == "animation" then
				addChatMessage("Âä®ÁîªÈÄüÂ∫¶Â∑≤ËÆæÁΩÆ‰∏∫ " .. cmd.value .. " (Â∞ÜÂú®‰∏ãÊ¨°Âä®ÁîªÊó∂ÁîüÊïà)", false)
			elseif cmd.type == "reset" then
				applyColorToAllUI(Colors.DefaultAccent)
				Colors.Transparent = 0.5
				saveColorConfig({accentColor = {52, 152, 219}})
                
                scaleFactor = isComputer and 1.3 or 1
                Main.Size = UDim2.new(0, 650 * scaleFactor, 0, 400 * scaleFactor)
                
                for _, obj in pairs(Main:GetDescendants()) do
                    if obj:IsA("TextLabel") or obj:IsA("TextBox") or obj:IsA("TextButton") then
                        if obj.TextSize and obj.TextSize >= 12 and obj.TextSize <= 18 then
                            Tween(obj, 0.3, "Sine", "Out", { TextSize = 14 })
                        end
                    end
                end
                
                for _, obj in pairs(Main:GetDescendants()) do
                    if obj:IsA("Frame") or obj:IsA("TextButton") or obj:IsA("ImageButton") then
                        local corner = obj:FindFirstChildOfClass("UICorner")
                        if corner then
                            Tween(corner, 0.3, "Sine", "Out", { CornerRadius = UDim.new(0, 6) })
                        end
                    end
                end
                
                for _, obj in pairs(Main:GetDescendants()) do
                    if obj.Name == "GlassEffect" then
                        obj.ImageTransparency = 0.5
                    end
                end
                
				addChatMessage("üîÑ UIÂ∑≤ÂÆåÂÖ®ÈáçÁΩÆ‰∏∫ÈªòËÆ§ËÆæÁΩÆÔºÅ", false)
            elseif cmd.type == "save" then
                local config = getCurrentConfig()
                if saveConfig(config) then
                    addChatMessage("‚úÖ ÈÖçÁΩÆÂ∑≤‰øùÂ≠òÔºÅ‰∏ãÊ¨°ÂêØÂä®Êó∂Â∞ÜËá™Âä®Â∫îÁî®Ê≠§ÈÖçÁΩÆ„ÄÇ", false)
                else
                    addChatMessage("‚ùå ‰øùÂ≠òÈÖçÁΩÆÂ§±Ë¥•ÔºÅ", false)
                end
            elseif cmd.type == "copy" then
                if copyConfigToClipboard() then
                    addChatMessage("‚úÖ ÈÖçÁΩÆÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ‰Ω†ÂèØ‰ª•Â∞ÜËøôÊÆµJSONÂèëÈÄÅÁªôAIÊù•Â∫îÁî®Áõ∏ÂêåÁöÑÈÖçÁΩÆ„ÄÇ", false)
                else
                    addChatMessage("‚ùå Â§çÂà∂ÈÖçÁΩÆÂ§±Ë¥•ÔºÅ", false)
                end
            elseif cmd.type == "apply_config" then
                local success, config = pcall(function()
                    return game:GetService("HttpService"):JSONDecode(cmd.value)
                end)
                if success then
                    applyFullConfig(config)
                    addChatMessage("‚úÖ ÈÖçÁΩÆÂ∑≤ÊàêÂäüÂ∫îÁî®ÔºÅÊâÄÊúâUIËÆæÁΩÆÂ∑≤Êõ¥Êñ∞„ÄÇ", false)
                else
                    addChatMessage("‚ùå ÈÖçÁΩÆÊ†ºÂºèÈîôËØØÔºåÊó†Ê≥ïÂ∫îÁî®ÔºÅËØ∑Ê£ÄÊü•JSONÊ†ºÂºèÊòØÂê¶Ê≠£Á°Æ„ÄÇ", false)
                end
            elseif cmd.type == "help" then
                showAllCommands()
			end
		end
	end

	local function getSystemPrompt()
        if aiMode == "custom" then
            return "‰Ω†ÊòØ‰∏Ä‰∏™UIÂä©ÊâãÔºåÂèØ‰ª•‰øÆÊîπUIÁöÑÂêÑÁßçÂ±ûÊÄß„ÄÇÁî®Êà∑ÂèØ‰ª•Áî®Ëá™ÁÑ∂ËØ≠Ë®ÄÊèèËø∞ÊÉ≥Ë¶ÅÁöÑ‰øÆÊîπÔºåÊØîÂ¶Ç'Êää‰∏ªÈ¢òÊîπÊàêÁ∫¢Ëâ≤'„ÄÅ'ÊääÊåâÈíÆÂèòÊàêÂúÜËßí'Á≠â„ÄÇËØ∑ÂàÜÊûêÁî®Êà∑ËØ∑Ê±ÇÔºåËøîÂõûÂèØÊâßË°åÁöÑ‰øÆÊîπÊåá‰ª§„ÄÇ"
        else
            return "‰Ω†ÊòØ‰∏Ä‰∏™ËÅäÂ§©Âä©ÊâãÔºåËØ∑ÂõûÁ≠îÁî®Êà∑ÁöÑÂêÑÁßçÈóÆÈ¢òÔºåËøõË°åËá™ÁÑ∂ÂØπËØù„ÄÇ"
        end
    end

	local function sendAIRequest()
		if AIInput.Text == "" then return end
		
		local userMessage = AIInput.Text
		addChatMessage(userMessage, true)
		AIInput.Text = ""
		
		local lowerMsg = userMessage:lower()
        if lowerMsg:match("ÂºÄÂêØËá™ÂÆö‰πâÊåá‰ª§") or lowerMsg:match("ÂàáÊç¢Âà∞Ëá™ÂÆö‰πâÊ®°Âºè") then
            aiMode = "custom"
            ModeToggleBtn.Text = "Ëá™ÂÆö‰πâÊåá‰ª§Ê®°Âºè"
            addChatMessage("Â∑≤ÂàáÊç¢Âà∞Ëá™ÂÆö‰πâÊåá‰ª§Ê®°ÂºèÔºåÁé∞Âú®ÂèØ‰ª•‰øÆÊîπUI‰∫ÜÔºÅ", false)
            return
        elseif lowerMsg:match("ÂºÄÂêØËÅäÂ§©Ê®°Âºè") or lowerMsg:match("ÂàáÊç¢Âà∞ËÅäÂ§©Ê®°Âºè") then
            aiMode = "chat"
            ModeToggleBtn.Text = "ËÅäÂ§©Ê®°Âºè"
            addChatMessage("Â∑≤ÂàáÊç¢Âà∞ËÅäÂ§©Ê®°ÂºèÔºåÁé∞Âú®ÂèØ‰ª•ËøõË°åËá™ÁÑ∂ÂØπËØù‰∫ÜÔºÅ", false)
            return
        end
		
		LoadingLabel.Visible = true
		AISendBtn.Active = false
		
		spawn(function()
			local success, result = pcall(function()
				local HttpService = game:GetService("HttpService")
				local payload = {
					model = MODEL,
					messages = {
						{
							role = "system",
							content = getSystemPrompt()
						},
						{
							role = "user",
							content = userMessage
						}
					},
					max_tokens = 500
				}
				
				local response = request({
					Url = "https://api.siliconflow.cn/v1/chat/completions",
					Method = "POST",
					Headers = {
						["Content-Type"] = "application/json",
						["Authorization"] = "Bearer " .. API_KEY
					},
					Body = HttpService:JSONEncode(payload)
				})
				
				if response.Success then
					local data = HttpService:JSONDecode(response.Body)
					return data.choices[1].message.content
				else
					return "ÈîôËØØ: APIËØ∑Ê±ÇÂ§±Ë¥• (Áä∂ÊÄÅÁ†Å: " .. response.StatusCode .. ")"
				end
			end)
			
			LoadingLabel.Visible = false
			AISendBtn.Active = true
			
			if success then
				addChatMessage(result, false)
				
				if aiMode == "custom" then
					local commands = parseAIResponse(result)
					if #commands > 0 then
						applyCommands(commands)
					else
						addChatMessage("Êú™ËØÜÂà´Âà∞ÂèØÊâßË°åÊåá‰ª§ÔºåËØ∑Â∞ùËØïÊõ¥ÊòéÁ°ÆÁöÑÊèèËø∞„ÄÇÂèëÈÄÅ\"Â∏ÆÂä©\"Êü•ÁúãÊâÄÊúâÊåá‰ª§„ÄÇ", false)
					end
				end
			else
				addChatMessage("ÂèëÁîüÈîôËØØ: " .. tostring(result), false)
			end
		end)
	end

	ModeToggleBtn.MouseButton1Click:Connect(function()
		aiMode = aiMode == "custom" and "chat" or "custom"
		ModeToggleBtn.Text = aiMode == "custom" and "Ëá™ÂÆö‰πâÊåá‰ª§Ê®°Âºè" or "ËÅäÂ§©Ê®°Âºè"
		
		addChatMessage("Â∑≤ÂàáÊç¢Âà∞ " .. ModeToggleBtn.Text, false)
	end)

	AIInput.FocusLost:Connect(function(enterPressed)
		if enterPressed then
			sendAIRequest()
		end
	end)

	AISendBtn.MouseButton1Click:Connect(function()
		sendAIRequest()
	end)

	Open.MouseButton1Click:Connect(function()
		Main.Visible = not Main.Visible
		if Main.Visible then
			Tween(Main, 0.2, "Sine", "Out", { Size = UDim2.new(0, 650 * scaleFactor, 0, 400 * scaleFactor) })
		end
	end)
	
	services.UserInputService.InputEnded:Connect(function(input)
		if input.KeyCode == Enum.KeyCode.LeftControl then
			Main.Visible = not Main.Visible
		end
	end)
	local currentConfig = loadConfig()
	local autoFitEnabled = currentConfig.autoFitScreen
	
	if autoFitEnabled then
		autoFitUIScreen(Main)
	end
	
	local scaleEnabled = false
	
	AutoFitBtn.MouseButton1Click:Connect(function()
		spawn(function()
			Ripple(AutoFitBtn)
		end)
		
		autoFitEnabled = not autoFitEnabled
		
		if autoFitEnabled then
			autoFitUIScreen(Main)
			Tween(AutoFitBtn, 0.2, "Sine", "Out", { ImageColor3 = Colors.Accent })
			Tween(AutoFitBtn, 0.2, "Sine", "Out", { BackgroundTransparency = 0 })
		else
			Main.Size = UDim2.new(0, 650 * scaleFactor, 0, 400 * scaleFactor)
			Main.Position = UDim2.new(0.5, 0, 0.5, 0)
			Tween(AutoFitBtn, 0.2, "Sine", "Out", { ImageColor3 = Colors.Text })
			Tween(AutoFitBtn, 0.2, "Sine", "Out", { BackgroundTransparency = 0.3 })
		end
		
		currentConfig.autoFitScreen = autoFitEnabled
		saveConfig(currentConfig)
	end)
	
	ScaleBtn.MouseButton1Click:Connect(function()
		spawn(function()
			Ripple(ScaleBtn)
		end)
		
		scaleEnabled = not scaleEnabled
		
		if scaleEnabled then
			Main.Size = UDim2.new(0, 325 * scaleFactor, 0, 200 * scaleFactor)
			Main.Position = UDim2.new(0.5, 0, 0.5, 0)
			Tween(ScaleBtn, 0.2, "Sine", "Out", { ImageColor3 = Colors.Accent })
			Tween(ScaleBtn, 0.2, "Sine", "Out", { BackgroundTransparency = 0 })
		else
			Main.Size = UDim2.new(0, 650 * scaleFactor, 0, 400 * scaleFactor)
			Main.Position = UDim2.new(0.5, 0, 0.5, 0)
			Tween(ScaleBtn, 0.2, "Sine", "Out", { ImageColor3 = Colors.Text })
			Tween(ScaleBtn, 0.2, "Sine", "Out", { BackgroundTransparency = 0.3 })
		end
	end)
	
	if autoFitEnabled then
		AutoFitBtn.ImageColor3 = Colors.Accent
		AutoFitBtn.BackgroundTransparency = 0
	else
		Tween(AutoFitBtn, 0, "Sine", "Out", { ImageColor3 = Colors.Text })
		Tween(AutoFitBtn, 0, "Sine", "Out", { BackgroundTransparency = 0.3 })
	end
	
	CloseBtn.MouseButton1Click:Connect(function()
		spawn(function()
			Ripple(CloseBtn)
		end)
		
		local confirmDialog = Instance.new("Frame")
		confirmDialog.Name = "ConfirmDialog"
		confirmDialog.Parent = Main
		confirmDialog.BackgroundColor3 = Colors.Secondary
		confirmDialog.BackgroundTransparency = 0
		confirmDialog.Position = UDim2.new(0.5, -150, 0.5, -60)
		confirmDialog.Size = UDim2.new(0, 300, 0, 120)
		confirmDialog.ZIndex = 100
		
		local confirmDialogC = Instance.new("UICorner")
		confirmDialogC.CornerRadius = UDim.new(0, 8)
		confirmDialogC.Parent = confirmDialog
		
		CreateGlassEffect(confirmDialog)
		
		local confirmStroke = Instance.new("UIStroke")
		confirmStroke.Color = Colors.Primary
		confirmStroke.Thickness = 2
		confirmStroke.Parent = confirmDialog
		
		local confirmTitle = Instance.new("TextLabel")
		confirmTitle.Parent = confirmDialog
		confirmTitle.BackgroundTransparency = 1
		confirmTitle.Position = UDim2.new(0, 0, 0, 15)
		confirmTitle.Size = UDim2.new(1, 0, 0, 30)
		confirmTitle.Font = Enum.Font.GothamBold
		confirmTitle.Text = "Á°ÆËÆ§Âà†Èô§UI"
		confirmTitle.TextColor3 = Colors.Text
		confirmTitle.TextSize = 18
		confirmTitle.ZIndex = 101
		
		local confirmText = Instance.new("TextLabel")
		confirmText.Parent = confirmDialog
		confirmText.BackgroundTransparency = 1
		confirmText.Position = UDim2.new(0, 0, 0, 45)
		confirmText.Size = UDim2.new(1, 0, 0, 30)
		confirmText.Font = Enum.Font.Gotham
		confirmText.Text = "Á°ÆÂÆöË¶ÅÂÆåÂÖ®Âà†Èô§Ëøô‰∏™UIÂêóÔºü"
		confirmText.TextColor3 = Colors.Text
		confirmText.TextSize = 14
		confirmText.ZIndex = 101
		
		local yesBtn = Instance.new("TextButton")
		yesBtn.Parent = confirmDialog
		yesBtn.BackgroundColor3 = Color3.fromRGB(231, 76, 60)
		yesBtn.Position = UDim2.new(0.2, 0, 1, -40)
		yesBtn.Size = UDim2.new(0, 80, 0, 30)
		yesBtn.Font = Enum.Font.GothamBold
		yesBtn.Text = "Âà†Èô§"
		yesBtn.TextColor3 = Colors.White
		yesBtn.TextSize = 14
		yesBtn.ZIndex = 101
		
		local yesBtnC = Instance.new("UICorner")
		yesBtnC.CornerRadius = UDim.new(0, 6)
		yesBtnC.Parent = yesBtn
		
		local noBtn = Instance.new("TextButton")
		noBtn.Parent = confirmDialog
		noBtn.BackgroundColor3 = Colors.Primary
		noBtn.Position = UDim2.new(0.6, 0, 1, -40)
		noBtn.Size = UDim2.new(0, 80, 0, 30)
		noBtn.Font = Enum.Font.GothamBold
		noBtn.Text = "ÂèñÊ∂à"
		noBtn.TextColor3 = Colors.Text
		noBtn.TextSize = 14
		noBtn.ZIndex = 101
		
		local noBtnC = Instance.new("UICorner")
		noBtnC.CornerRadius = UDim.new(0, 6)
		noBtnC.Parent = noBtn
		
		yesBtn.MouseButton1Click:Connect(function()
			if canvasPart then
				canvasPart:Destroy()
			end
			if dogent then
				dogent:Destroy()
			end
			if switchGui then
				switchGui:Destroy()
			end
			if renderConnection then
				renderConnection:Disconnect()
			end
		end)
		
		noBtn.MouseButton1Click:Connect(function()
			confirmDialog:Destroy()
		end)
	end)
	
	local TitleBar = Instance.new("Frame")
	TitleBar.Name = "TitleBar"
	TitleBar.Parent = Main
	TitleBar.BackgroundColor3 = Colors.Secondary
	TitleBar.BackgroundTransparency = Colors.Transparent
	TitleBar.Size = UDim2.new(1, 0, 0, 45)
	TitleBar.Active = false
	
	local TitleBarC = Instance.new("UICorner")
	TitleBarC.CornerRadius = UDim.new(0, 8)
	TitleBarC.Parent = TitleBar
	
	local Title = Instance.new("TextLabel")
	Title.Name = "ScriptTitle"
	Title.Parent = TitleBar
	Title.BackgroundTransparency = 1
	Title.Position = UDim2.new(0, 15, 0, 0)
	Title.Size = UDim2.new(1, -30, 1, 0)
	Title.Font = Enum.Font.GothamBlack
	Title.Text = name
	Title.TextColor3 = Colors.Text
	Title.TextSize = 18
	Title.TextXAlignment = Enum.TextXAlignment.Left
	
	local TitleGradient = Instance.new("UIGradient")
	TitleGradient.Color = ColorSequence.new({
		ColorSequenceKeypoint.new(0.00, Color3.fromRGB(52, 152, 219)),
		ColorSequenceKeypoint.new(0.50, Color3.fromRGB(41, 128, 185)),
		ColorSequenceKeypoint.new(1.00, Color3.fromRGB(31, 97, 141)),
	})
	TitleGradient.Parent = Title
	
	coroutine.wrap(function()
		while dogent.Parent do
			Tween(TitleGradient, 7, "Linear", "In", { Rotation = 360 })
			wait(7)
			TitleGradient.Rotation = 0
		end
	end)()
	
	local SearchBar = Instance.new("Frame")
	SearchBar.Name = "SearchBar"
	SearchBar.Parent = Main
	SearchBar.BackgroundColor3 = Colors.Secondary
	SearchBar.BackgroundTransparency = Colors.Transparent
	SearchBar.Position = UDim2.new(0, 15, 0, 55)
	SearchBar.Size = UDim2.new(1, -30, 0, 35)
	
	local SearchBarC = Instance.new("UICorner")
	SearchBarC.CornerRadius = UDim.new(0, 6)
	SearchBarC.Parent = SearchBar
	
	CreateGlassEffect(SearchBar)
	
	local SearchIcon = Instance.new("ImageLabel")
	SearchIcon.Name = "SearchIcon"
	SearchIcon.Parent = SearchBar
	SearchIcon.BackgroundTransparency = 1
	SearchIcon.Position = UDim2.new(0, 10, 0.5, -10)
	SearchIcon.Size = UDim2.new(0, 20, 0, 20)
	SearchIcon.Image = "rbxassetid://3926305904"
	SearchIcon.ImageRectOffset = Vector2.new(964, 324)
	SearchIcon.ImageRectSize = Vector2.new(36, 36)
	SearchIcon.ImageColor3 = Colors.Placeholder
	
	local SearchBox = Instance.new("TextBox")
	SearchBox.Name = "SearchBox"
	SearchBox.Parent = SearchBar
	SearchBox.BackgroundTransparency = 1
	SearchBox.Position = UDim2.new(0, 40, 0, 0)
	SearchBox.Size = UDim2.new(1, -50, 1, 0)
	SearchBox.Font = Enum.Font.Gotham
	SearchBox.PlaceholderText = "ÊêúÁ¥¢Ê†áÁ≠æÈ°µÊàñÂäüËÉΩ..."
	SearchBox.Text = ""
	SearchBox.TextColor3 = Colors.Text
	SearchBox.PlaceholderColor3 = Colors.Placeholder
	SearchBox.TextSize = 14
	SearchBox.ClearTextOnFocus = false
	
	SearchBox.Focused:Connect(function()
		if SearchBox.Text == SearchBox.PlaceholderText then
			SearchBox.Text = ""
		end
	end)
	
	SearchBox.FocusLost:Connect(function()
		if SearchBox.Text == "" then
			SearchBox.Text = ""
		end
	end)
	
	local Content = Instance.new("Frame")
	Content.Name = "Content"
	Content.Parent = Main
	Content.BackgroundTransparency = 1
	Content.Position = UDim2.new(0, 0, 0, 100)
	Content.Size = UDim2.new(1, 0, 1, -100)
	
	local AnimationsFrame = Instance.new("Frame")
	AnimationsFrame.Name = "AnimationsFrame"
	AnimationsFrame.Parent = Main
	AnimationsFrame.BackgroundColor3 = Colors.Secondary
	AnimationsFrame.BackgroundTransparency = Colors.Transparent
	AnimationsFrame.Position = UDim2.new(0, 0, 0, 100)
	AnimationsFrame.Size = UDim2.new(1, 0, 1, -100)
	AnimationsFrame.Visible = false
	AnimationsFrame.ZIndex = 15

	local AnimationsC = Instance.new("UICorner")
	AnimationsC.CornerRadius = UDim.new(0, 8)
	AnimationsC.Parent = AnimationsFrame

	CreateGlassEffect(AnimationsFrame)

	local AnimationsTitle = Instance.new("TextLabel")
	AnimationsTitle.Name = "AnimationsTitle"
	AnimationsTitle.Parent = AnimationsFrame
	AnimationsTitle.BackgroundTransparency = 1
	AnimationsTitle.Position = UDim2.new(0, 15, 0, 15)
	AnimationsTitle.Size = UDim2.new(1, -30, 0, 30)
	AnimationsTitle.Font = Enum.Font.GothamBlack
	AnimationsTitle.Text = "Âä®ÁîªÂ∫ì - ÁÇπÂáªÂè≥‰∏äËßíÊåâÈíÆËøîÂõû"
	AnimationsTitle.TextColor3 = Colors.Text
	AnimationsTitle.TextSize = 18
	AnimationsTitle.TextXAlignment = Enum.TextXAlignment.Left
	AnimationsTitle.ZIndex = 16

	local AnimSearchBar = Instance.new("Frame")
	AnimSearchBar.Name = "AnimSearchBar"
	AnimSearchBar.Parent = AnimationsFrame
	AnimSearchBar.BackgroundColor3 = Colors.Primary
	AnimSearchBar.BackgroundTransparency = 0.5
	AnimSearchBar.Position = UDim2.new(0, 15, 0, 55)
	AnimSearchBar.Size = UDim2.new(1, -30, 0, 35)
	AnimSearchBar.ZIndex = 16

	local AnimSearchBarC = Instance.new("UICorner")
	AnimSearchBarC.CornerRadius = UDim.new(0, 6)
	AnimSearchBarC.Parent = AnimSearchBar

	local AnimSearchIcon = Instance.new("ImageLabel")
	AnimSearchIcon.Name = "AnimSearchIcon"
	AnimSearchIcon.Parent = AnimSearchBar
	AnimSearchIcon.BackgroundTransparency = 1
	AnimSearchIcon.Position = UDim2.new(0, 10, 0.5, -10)
	AnimSearchIcon.Size = UDim2.new(0, 20, 0, 20)
	AnimSearchIcon.Image = "rbxassetid://3926305904"
	AnimSearchIcon.ImageRectOffset = Vector2.new(964, 324)
	AnimSearchIcon.ImageRectSize = Vector2.new(36, 36)
	AnimSearchIcon.ImageColor3 = Colors.Placeholder
	AnimSearchIcon.ZIndex = 17

	local AnimSearchBox = Instance.new("TextBox")
	AnimSearchBox.Name = "AnimSearchBox"
	AnimSearchBox.Parent = AnimSearchBar
	AnimSearchBox.BackgroundTransparency = 1
	AnimSearchBox.Position = UDim2.new(0, 40, 0, 0)
	AnimSearchBox.Size = UDim2.new(1, -50, 1, 0)
	AnimSearchBox.Font = Enum.Font.Gotham
	AnimSearchBox.PlaceholderText = "ÊêúÁ¥¢Âä®‰ΩúÊàñÂä®ÁîªÂåÖ..."
	AnimSearchBox.Text = ""
	AnimSearchBox.TextColor3 = Colors.Text
	AnimSearchBox.PlaceholderColor3 = Colors.Placeholder
	AnimSearchBox.TextSize = 14
	AnimSearchBox.ClearTextOnFocus = false
	AnimSearchBox.ZIndex = 17

	local AnimationsGrid = Instance.new("ScrollingFrame")
	AnimationsGrid.Name = "AnimationsGrid"
	AnimationsGrid.Parent = AnimationsFrame
	AnimationsGrid.BackgroundTransparency = 1
	AnimationsGrid.Position = UDim2.new(0, 15, 0, 100)
	AnimationsGrid.Size = UDim2.new(1, -30, 1, -115)
	AnimationsGrid.CanvasSize = UDim2.new(0, 0, 0, 0)
	AnimationsGrid.ScrollBarThickness = 2
	AnimationsGrid.ZIndex = 16

	local GridLayout = Instance.new("UIGridLayout")
	GridLayout.Name = "GridLayout"
	GridLayout.Parent = AnimationsGrid
	GridLayout.CellSize = UDim2.new(0, 80, 0, 100)
	GridLayout.CellPadding = UDim2.new(0, 5, 0, 5)
	GridLayout.StartCorner = Enum.StartCorner.TopLeft
	GridLayout.FillDirection = Enum.FillDirection.Horizontal
	GridLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
	GridLayout.SortOrder = Enum.SortOrder.LayoutOrder

	local function fetchCatalogItems(itemType, cursor)
		local HttpService = game:GetService("HttpService")
		local PROXY_URL = "https://rproxy.kirbs.net"
		
		local endpoint = string.format(
			"%s/v1/search/items?category=Animations&limit=100&cursor=%s",
			PROXY_URL,
			cursor or ""
		)
		
		local success, data = pcall(function()
			local response = game:HttpGet(endpoint)
			return HttpService:JSONDecode(response)
		end)
		
		if success then
			return {
				items = data.data or {},
				nextCursor = data.nextPageCursor or ""
			}
		else
			return {items = {}, nextCursor = ""}
		end
	end

	local function fetchAssetDetails(assetIds)
		local HttpService = game:GetService("HttpService")
		local PROXY_URL = "https://rproxy.kirbs.net"
		
		local endpoint = string.format(
			"%s/v1/assets?assetIds=%s",
			PROXY_URL,
			table.concat(assetIds, ",")
		)
		
		local success, data = pcall(function()
			local response = game:HttpGet(endpoint)
			return HttpService:JSONDecode(response)
		end)
		
		if success then
			return data.data or {}
		else
			return {}
		end
	end

	local function fetchBundleItems(bundleId)
		local HttpService = game:GetService("HttpService")
		local PROXY_URL = "https://rproxy.kirbs.net"
		
		local endpoint = string.format(
			"%s/v1/bundles/%s/bundleItems",
			PROXY_URL,
			bundleId
		)
		
		local success, data = pcall(function()
			local response = game:HttpGet(endpoint)
			return HttpService:JSONDecode(response)
		end)
		
		if success then
			local bundledItems = {}
			for _, item in pairs(data.data or {}) do
				if item.type == "Asset" then
					table.insert(bundledItems, item.id)
				end
			end
			return bundledItems
		else
			return {}
		end
	end

	local function loadAnimations(searchTerm)
		for _, child in pairs(AnimationsGrid:GetChildren()) do
			if child:IsA("ImageButton") or child:IsA("TextLabel") then
				child:Destroy()
			end
		end
		
		spawn(function()
			local loadingLabel = Instance.new("TextLabel")
			loadingLabel.Name = "LoadingLabel"
			loadingLabel.Parent = AnimationsGrid
			loadingLabel.BackgroundTransparency = 1
			loadingLabel.Size = UDim2.new(1, 0, 0, 50)
			loadingLabel.Font = Enum.Font.GothamSemibold
			loadingLabel.Text = "Ê≠£Âú®Âä†ËΩΩÂä®Áîª..."
			loadingLabel.TextColor3 = Colors.Text
			loadingLabel.TextSize = 14
			loadingLabel.ZIndex = 17
			
			local success, animationsData = pcall(function()
				return fetchCatalogItems("Animations")
			end)
			
			if loadingLabel and loadingLabel.Parent then
				loadingLabel:Destroy()
			end
			
			if not success or not animationsData or not animationsData.items then
				local errorLabel = Instance.new("TextLabel")
				errorLabel.Name = "ErrorLabel"
				errorLabel.Parent = AnimationsGrid
				errorLabel.BackgroundTransparency = 1
				errorLabel.Size = UDim2.new(1, 0, 0, 100)
				errorLabel.Position = UDim2.new(0, 0, 0.3, 0)
				errorLabel.Font = Enum.Font.GothamSemibold
				errorLabel.Text = "Êó†Ê≥ïÂä†ËΩΩÂä®Áîª\nËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÊàñÁ®çÂêéÂÜçËØï"
				errorLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
				errorLabel.TextSize = 14
				errorLabel.TextWrapped = true
				errorLabel.ZIndex = 17
				return
			end
			
			local animations = animationsData.items
			local loadedCount = 0
			
			for i, anim in ipairs(animations) do
				if i <= 100 then
					local animName = anim.name or "Âä®Áîª"
					
					if searchTerm == "" or animName:lower():find(searchTerm:lower(), 1, true) then
						local animButton = Instance.new("ImageButton")
						animButton.Name = "Anim_" .. (anim.id or i)
						animButton.Parent = AnimationsGrid
						animButton.BackgroundColor3 = Colors.Primary
						animButton.BackgroundTransparency = 0.3
						animButton.Size = UDim2.new(0, 80, 0, 100)
						animButton.AutoButtonColor = false
						animButton.ZIndex = 17
						
						animButton.Image = "rbxassetid://10734982320"
						
						local animCorner = Instance.new("UICorner")
						animCorner.CornerRadius = UDim.new(0, 6)
						animCorner.Parent = animButton
						
						local animTitle = Instance.new("TextLabel")
						animTitle.Parent = animButton
						animTitle.BackgroundColor3 = Colors.Secondary
						animTitle.BackgroundTransparency = 0.5
						animTitle.Position = UDim2.new(0, 0, 0, 80)
						animTitle.Size = UDim2.new(1, 0, 0, 20)
						animTitle.Font = Enum.Font.GothamSemibold
						animTitle.Text = animName
						animTitle.TextColor3 = Colors.Text
						animTitle.TextSize = 10
						animTitle.TextWrapped = true
						animTitle.ZIndex = 18
						
						local titleCorner = Instance.new("UICorner")
						titleCorner.CornerRadius = UDim.new(0, 6)
						titleCorner.Parent = animTitle
						
						animButton.MouseButton1Click:Connect(function()
							local character = services.Players.LocalPlayer.Character
							if character and character:FindFirstChild("Humanoid") then
								local animation = Instance.new("Animation")
								animation.AnimationId = "rbxassetid://" .. anim.id
								
								local animator = character.Humanoid:FindFirstChildOfClass("Animator") or Instance.new("Animator")
								animator.Parent = character.Humanoid
								
								local animationTrack = animator:LoadAnimation(animation)
								animationTrack:Play()
								
								addChatMessage("Ê≠£Âú®Êí≠ÊîæÂä®Áîª: " .. animName, false)
							end
						end)
						
						animButton.MouseEnter:Connect(function()
							Tween(animButton, 0.2, "Sine", "Out", { BackgroundTransparency = 0 })
						end)
						
						animButton.MouseLeave:Connect(function()
							Tween(animButton, 0.2, "Sine", "Out", { BackgroundTransparency = 0.3 })
						end)
						
						loadedCount = loadedCount + 1
					end
				end
			end
			
			if loadedCount == 0 and searchTerm ~= "" then
				local noResultLabel = Instance.new("TextLabel")
				noResultLabel.Name = "NoResultLabel"
				noResultLabel.Parent = AnimationsGrid
				noResultLabel.BackgroundTransparency = 1
				noResultLabel.Size = UDim2.new(1, 0, 0, 50)
				noResultLabel.Font = Enum.Font.GothamSemibold
				noResultLabel.Text = "Êú™ÊâæÂà∞ÂåπÈÖçÁöÑÂä®Áîª: " .. searchTerm
				noResultLabel.TextColor3 = Colors.Placeholder
				noResultLabel.TextSize = 14
				noResultLabel.ZIndex = 17
			end
		end)
	end

	AnimSearchBox:GetPropertyChangedSignal("Text"):Connect(function()
		loadAnimations(AnimSearchBox.Text)
	end)

	AnimationsBtn.MouseButton1Click:Connect(function()
		spawn(function()
			Ripple(AnimationsBtn)
		end)
		
		local showAnimations = not AnimationsFrame.Visible
		
		if showAnimations then
			Content.Visible = false
			AIPanelFrame.Visible = false
			AnimationsFrame.Visible = true
			Tween(AnimationsBtn, 0.2, "Sine", "Out", { ImageColor3 = Colors.Accent })
			Tween(AnimationsBtn, 0.2, "Sine", "Out", { BackgroundTransparency = 0 })
			loadAnimations("")
		else
			AnimationsFrame.Visible = false
			Content.Visible = true
			Tween(AnimationsBtn, 0.2, "Sine", "Out", { ImageColor3 = Colors.Text })
			Tween(AnimationsBtn, 0.2, "Sine", "Out", { BackgroundTransparency = 0.3 })
		end
	end)
	
	local SideBar = Instance.new("Frame")
	SideBar.Name = "SideBar"
	SideBar.Parent = Content
	SideBar.BackgroundColor3 = Colors.Secondary
	SideBar.BackgroundTransparency = Colors.Transparent
	SideBar.Size = UDim2.new(0, 140, 1, 0)
	
	local SideBarC = Instance.new("UICorner")
	SideBarC.CornerRadius = UDim.new(0, 8)
	SideBarC.Parent = SideBar
	
	CreateGlassEffect(SideBar)
	
	local TabButtons = Instance.new("ScrollingFrame")
	TabButtons.Name = "TabBts"
	TabButtons.Parent = SideBar
	TabButtons.Active = true
	TabButtons.BackgroundTransparency = 1
	TabButtons.BorderSizePixel = 0
	TabButtons.Position = UDim2.new(0, 5, 0, 5)
	TabButtons.Size = UDim2.new(1, -10, 1, -10)
	TabButtons.CanvasSize = UDim2.new(0, 0, 0, 0)
	TabButtons.ScrollBarThickness = 2
	TabButtons.ScrollBarImageColor3 = Colors.Secondary
	
	local TabButtonsL = Instance.new("UIListLayout")
	TabButtonsL.Name = "TabBtsL"
	TabButtonsL.Parent = TabButtons
	TabButtonsL.SortOrder = Enum.SortOrder.LayoutOrder
	TabButtonsL.Padding = UDim.new(0, 8)
	
	TabButtonsL:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
		TabButtons.CanvasSize = UDim2.new(0, 0, 0, TabButtonsL.AbsoluteContentSize.Y + 10)
	end)
	
	local TabMain = Instance.new("Frame")
	TabMain.Name = "TabMain"
	TabMain.Parent = Content
	TabMain.BackgroundTransparency = 1
	TabMain.Position = UDim2.new(0, 145, 0, 0)
	TabMain.Size = UDim2.new(1, -145, 1, 0)
	
	local allTabs = {}
	local tabInfos = {}
	
	SearchBox:GetPropertyChangedSignal("Text"):Connect(function()
		local searchText = SearchBox.Text:lower()
		
		if searchText == "" then
			for _, tabInfo in ipairs(allTabs) do
				tabInfo.button.Visible = true
				tabInfo.button.TabText.Text = tabInfo.name 
				tabInfo.button.TabText.RichText = false
				
				for _, sectionInfo in ipairs(tabInfo.sections or {}) do
					sectionInfo.section.Visible = true
					sectionInfo.objsFrame.Visible = true
					sectionInfo.section.SectionText.Text = sectionInfo.name
					sectionInfo.section.SectionText.RichText = false
					
					local ObjsL = sectionInfo.objsFrame:FindFirstChild("ObjsL")
					if ObjsL then
						local originalHeight = 42 + ObjsL.AbsoluteContentSize.Y + 10
						sectionInfo.section.Size = UDim2.new(0.975, 0, 0, originalHeight)
					end
					
					for _, component in ipairs(sectionInfo.objsFrame:GetChildren()) do
						if component:IsA("Frame") then
							local textElement = component:FindFirstChildWhichIsA("TextButton") or 
												component:FindFirstChildWhichIsA("TextLabel")
							if textElement and sectionInfo.originalTexts then
								local original = sectionInfo.originalTexts[component]
								if original then
									textElement.Text = original
									textElement.RichText = false
								end
							end
						end
					end
				end
			end
			
			if library.currentTab and not library.currentTab.button.Visible then
				for _, tabInfo in ipairs(allTabs) do
					if tabInfo.button.Visible then
						switchTab({
							button = tabInfo.button,
							frame = tabInfo.frame
						})
						break
					end
				end
			end
			
			return
		end
		
		for _, tabInfo in ipairs(allTabs) do
			local tabVisible = false
			
			local tabTextHighlighted = highlightText(tabInfo.name, searchText)
			tabInfo.button.TabText.Text = tabTextHighlighted
			tabInfo.button.TabText.RichText = true
			if tabTextHighlighted ~= tabInfo.name then
				tabVisible = true
			end
			
			for _, sectionInfo in ipairs(tabInfo.sections or {}) do
				local sectionVisible = false
				
				local sectionTextHighlighted = highlightText(sectionInfo.name, searchText)
				sectionInfo.section.SectionText.Text = sectionTextHighlighted
				sectionInfo.section.SectionText.RichText = true
				if sectionTextHighlighted ~= sectionInfo.name then
					sectionVisible = true
					tabVisible = true
				end
				
				sectionInfo.originalTexts = sectionInfo.originalTexts or {}
				for _, component in ipairs(sectionInfo.objsFrame:GetChildren()) do
					if component:IsA("Frame") then
						local textElement = component:FindFirstChildWhichIsA("TextButton") or 
											component:FindFirstChildWhichIsA("TextLabel")
						if textElement then
							if not sectionInfo.originalTexts[component] then
								sectionInfo.originalTexts[component] = textElement.Text
							end
							
							local originalText = sectionInfo.originalTexts[component]
							local highlightedText = highlightText(originalText, searchText)
							
							if highlightedText ~= originalText then
								textElement.Text = highlightedText
								textElement.RichText = true
								sectionVisible = true
								tabVisible = true
							else
								for _, componentText in ipairs(sectionInfo.components or {}) do
									if componentText:lower():find(searchText, 1, true) then
										sectionVisible = true
										tabVisible = true
										break
									end
								end
							end
						end
					end
				end
				
				sectionInfo.section.Visible = sectionVisible
				sectionInfo.objsFrame.Visible = sectionVisible
			end
			
			tabInfo.button.Visible = tabVisible
			
			if not tabInfo.button.Visible and library.currentTab and library.currentTab.button == tabInfo.button then
				for _, otherTabInfo in ipairs(allTabs) do
					if otherTabInfo.button.Visible then
						switchTab({
							button = otherTabInfo.button,
							frame = otherTabInfo.frame
						})
						break
					end
				end
			end
		end
	end)
	
	local window = {}
	local switchingTabs = false
	
	function switchTab(new)
		if switchingTabs then return end
		local old = library.currentTab
		if old == nil then
			new.frame.Visible = true
			library.currentTab = new
			Tween(new.button, 0.15, "Sine", "Out", { BackgroundTransparency = 0 })
			Tween(new.button.TabText, 0.15, "Sine", "Out", { TextTransparency = 0 })
			return
		end
		if old.button == new.button then return end
		
		switchingTabs = true
		library.currentTab = new
		
		Tween(old.button, 0.15, "Sine", "Out", { BackgroundTransparency = 0.3 })
		Tween(new.button, 0.15, "Sine", "Out", { BackgroundTransparency = 0 })
		Tween(old.button.TabText, 0.15, "Sine", "Out", { TextTransparency = 0.3 })
		Tween(new.button.TabText, 0.15, "Sine", "Out", { TextTransparency = 0 })
		
		old.frame.Visible = false
		new.frame.Visible = true
		
		task.wait(0.15)
		switchingTabs = false
	end
	
	function window.Tab(window, name, icon)
		local tabButton = Instance.new("Frame")
		tabButton.Name = "TabButton"
		tabButton.Parent = TabButtons
		tabButton.BackgroundColor3 = Colors.Secondary
		tabButton.BackgroundTransparency = 0.3
		tabButton.Size = UDim2.new(1, 0, 0, 40)
		
		local tabButtonC = Instance.new("UICorner")
		tabButtonC.CornerRadius = UDim.new(0, 6)
		tabButtonC.Parent = tabButton
		
		CreateGlassEffect(tabButton)
		
		local tabIcon = Instance.new("ImageLabel")
		tabIcon.Name = "TabIcon"
		tabIcon.Parent = tabButton
		tabIcon.BackgroundTransparency = 1
		tabIcon.Position = UDim2.new(0, 10, 0.5, -12)
		tabIcon.Size = UDim2.new(0, 24, 0, 24)
		tabIcon.Image = ("rbxassetid://%s"):format(icon or 4370341699)
		tabIcon.ImageColor3 = Colors.Text
		
		local tabText = Instance.new("TextLabel")
		tabText.Name = "TabText"
		tabText.Parent = tabButton
		tabText.BackgroundTransparency = 1
		tabText.Position = UDim2.new(0, 45, 0, 0)
		tabText.Size = UDim2.new(1, -50, 1, 0)
		tabText.Font = Enum.Font.GothamSemibold
		tabText.Text = name
		tabText.TextColor3 = Colors.Text
		tabText.TextSize = 14
		tabText.TextXAlignment = Enum.TextXAlignment.Left
		
		local tabBtn = Instance.new("TextButton")
		tabBtn.Name = "TabBtn"
		tabBtn.Parent = tabButton
		tabBtn.BackgroundTransparency = 1
		tabBtn.Size = UDim2.new(1, 0, 1, 0)
		tabBtn.Text = ""
		
		local tabFrame = Instance.new("ScrollingFrame")
		tabFrame.Name = "Tab"
		tabFrame.Parent = TabMain
		tabFrame.BackgroundTransparency = 1
		tabFrame.Size = UDim2.new(1, 0, 1, 0)
		tabFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
		tabFrame.ScrollBarThickness = 2
		tabFrame.Visible = false
		
		local tabL = Instance.new("UIListLayout")
		tabL.Name = "TabL"
		tabL.Parent = tabFrame
		tabL.SortOrder = Enum.SortOrder.LayoutOrder
		tabL.Padding = UDim.new(0, 8)
		
		local tabInfo = {
			name = name,
			button = tabButton,
			frame = tabFrame,
			searchableComponents = {},
			sections = {}
		}
		table.insert(allTabs, tabInfo)
		
		tabBtn.MouseButton1Click:Connect(function()
			spawn(function()
				Ripple(tabButton)
			end)
			switchTab({
				button = tabButton,
				frame = tabFrame
			})
		end)
		
		if library.currentTab == nil then
			switchTab({
				button = tabButton,
				frame = tabFrame
			})
		end
		
		tabL:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
			tabFrame.CanvasSize = UDim2.new(0, 0, 0, tabL.AbsoluteContentSize.Y + 16)
		end)
		
		local tab = {}
		tab._info = tabInfo
		
		function tab.section(tab, name, TabVal)
			local Section = Instance.new("Frame")
			Section.Name = "Section"
			Section.Parent = tabFrame
			Section.BackgroundColor3 = Colors.Secondary
			Section.BackgroundTransparency = Colors.Transparent
			Section.BorderSizePixel = 0
			Section.ClipsDescendants = true
			Section.Size = UDim2.new(0.975, 0, 0, 42)
			
			CreateGlassEffect(Section)
			
			local SectionC = Instance.new("UICorner")
			SectionC.CornerRadius = UDim.new(0, 8)
			SectionC.Parent = Section
			
			local SectionStroke = Instance.new("UIStroke")
			SectionStroke.Color = Colors.Primary
			SectionStroke.Thickness = 1
			SectionStroke.Transparency = 0.5
			SectionStroke.Parent = Section
			
			local SectionText = Instance.new("TextLabel")
			SectionText.Name = "SectionText"
			SectionText.Parent = Section
			SectionText.BackgroundTransparency = 1
			SectionText.Position = UDim2.new(0, 40, 0, 0)
			SectionText.Size = UDim2.new(1, -45, 0, 42)
			SectionText.Font = Enum.Font.GothamBold
			SectionText.Text = name
			SectionText.TextColor3 = Colors.Text
			SectionText.TextSize = 16
			SectionText.TextXAlignment = Enum.TextXAlignment.Left
			
			local SectionOpen = Instance.new("ImageLabel")
			SectionOpen.Name = "SectionOpen"
			SectionOpen.Parent = SectionText
			SectionOpen.BackgroundTransparency = 1
			SectionOpen.BorderSizePixel = 0
			SectionOpen.Position = UDim2.new(0, -30, 0, 8)
			SectionOpen.Size = UDim2.new(0, 26, 0, 26)
			SectionOpen.Image = "http://www.roblox.com/asset/?id=6031302934"
			SectionOpen.ImageColor3 = Colors.Text
			
			local SectionOpened = Instance.new("ImageLabel")
			SectionOpened.Name = "SectionOpened"
			SectionOpened.Parent = SectionOpen
			SectionOpened.BackgroundTransparency = 1.000
			SectionOpened.BorderSizePixel = 0
			SectionOpened.Size = UDim2.new(0, 26, 0, 26)
			SectionOpened.Image = "http://www.roblox.com/asset/?id=6031302932"
			SectionOpened.ImageTransparency = 1.000
			SectionOpened.ImageColor3 = Colors.Text
			
			local SectionToggle = Instance.new("ImageButton")
			SectionToggle.Name = "SectionToggle"
			SectionToggle.Parent = SectionOpen
			SectionToggle.BackgroundTransparency = 1
			SectionToggle.BorderSizePixel = 0
			SectionToggle.Size = UDim2.new(0, 26, 0, 26)
			
			local Objs = Instance.new("Frame")
			Objs.Name = "Objs"
			Objs.Parent = Section
			Objs.BackgroundTransparency = 1
			Objs.BorderSizePixel = 0
			Objs.Position = UDim2.new(0, 6, 0, 42)
			Objs.Size = UDim2.new(1, -12, 0, 0)
			
			local ObjsL = Instance.new("UIListLayout")
			ObjsL.Name = "ObjsL"
			ObjsL.Parent = Objs
			ObjsL.SortOrder = Enum.SortOrder.LayoutOrder
			ObjsL.Padding = UDim.new(0, 8)
			
			local open = TabVal
			if TabVal ~= false then
				Section.Size = UDim2.new(0.975, 0, 0, open and 42 + ObjsL.AbsoluteContentSize.Y + 10 or 42)
				SectionOpened.ImageTransparency = (open and 0 or 1)
				SectionOpen.ImageTransparency = (open and 1 or 0)
			end
			
			SectionToggle.MouseButton1Click:Connect(function()
				open = not open
				Section.Size = UDim2.new(0.975, 0, 0, open and 42 + ObjsL.AbsoluteContentSize.Y + 10 or 42)
				SectionOpened.ImageTransparency = (open and 0 or 1)
				SectionOpen.ImageTransparency = (open and 1 or 0)
				Tween(Section, 0.2, "Sine", "Out", { BackgroundTransparency = open and 0.25 or 0 })
			end)
			
			ObjsL:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
				if not open then return end
				Section.Size = UDim2.new(0.975, 0, 0, 42 + ObjsL.AbsoluteContentSize.Y + 10)
			end)
			
			local sectionInfo = {
				name = name,
				section = Section,
				objsFrame = Objs,
				components = {},
				originalTexts = {} 
			}
			table.insert(tabInfo.sections, sectionInfo)
			
			local section = {}
			
			function section.Button(section, text, callback)
				local callback = callback or function() end
				table.insert(tabInfo.searchableComponents, text)
				table.insert(sectionInfo.components, text)
				local BtnModule = Instance.new("Frame")
				BtnModule.Name = "BtnModule"
				BtnModule.Parent = Objs
				BtnModule.BackgroundTransparency = 1
				BtnModule.Size = UDim2.new(1, 0, 0, 40)
				
				local Btn = Instance.new("TextButton")
				Btn.Name = "Btn"
				Btn.Parent = BtnModule
				Btn.BackgroundColor3 = Colors.Secondary
				Btn.BackgroundTransparency = 0.3
				Btn.Size = UDim2.new(1, 0, 1, 0)
				Btn.AutoButtonColor = false
				Btn.Font = Enum.Font.GothamSemibold
				Btn.Text = "   " .. text
				Btn.TextColor3 = Colors.Text
				Btn.TextSize = 15
				Btn.TextXAlignment = Enum.TextXAlignment.Left
				Btn.RichText = false 
				
				CreateGlassEffect(Btn)
				
				local BtnC = Instance.new("UICorner")
				BtnC.CornerRadius = UDim.new(0, 6)
				BtnC.Parent = Btn
				
				sectionInfo.originalTexts[BtnModule] = text
				
				Btn.MouseButton1Click:Connect(function()
					spawn(function()
						Ripple(Btn)
					end)
					spawn(callback)
				end)
			end
			
			function section:Label(text)
				table.insert(tabInfo.searchableComponents, text)
				table.insert(sectionInfo.components, text)
				local LabelModule = Instance.new("Frame")
				LabelModule.Name = "LabelModule"
				LabelModule.Parent = Objs
				LabelModule.BackgroundTransparency = 1
				LabelModule.Size = UDim2.new(1, 0, 0, 30)
				
				local TextLabel = Instance.new("TextLabel")
				TextLabel.Parent = LabelModule
				TextLabel.BackgroundColor3 = Colors.Secondary
				TextLabel.BackgroundTransparency = 0.3
				TextLabel.Size = UDim2.new(1, 0, 1, 0)
				TextLabel.Font = Enum.Font.GothamSemibold
				TextLabel.Text = text
				TextLabel.TextColor3 = Colors.Text
				TextLabel.TextSize = 14
				TextLabel.TextWrapped = true
				TextLabel.RichText = false 
				
				CreateGlassEffect(TextLabel)
				
				local LabelC = Instance.new("UICorner")
				LabelC.CornerRadius = UDim.new(0, 6)
				LabelC.Parent = TextLabel
				
				sectionInfo.originalTexts[LabelModule] = text
				
				return TextLabel
			end
			
			function section.Toggle(section, text, flag, enabled, callback)
				local callback = callback or function() end
				local enabled = enabled or false
				assert(text, "No text provided")
				assert(flag, "No flag provided")
				library.flags[flag] = enabled
				table.insert(tabInfo.searchableComponents, text)
				table.insert(sectionInfo.components, text)
				
				local ToggleModule = Instance.new("Frame")
				ToggleModule.Name = "ToggleModule"
				ToggleModule.Parent = Objs
				ToggleModule.BackgroundTransparency = 1
				ToggleModule.Size = UDim2.new(1, 0, 0, 40)
				
				local ToggleBtn = Instance.new("TextButton")
				ToggleBtn.Name = "ToggleBtn"
				ToggleBtn.Parent = ToggleModule
				ToggleBtn.BackgroundColor3 = Colors.Secondary
				ToggleBtn.BackgroundTransparency = 0.3
				ToggleBtn.Size = UDim2.new(1, 0, 1, 0)
				ToggleBtn.AutoButtonColor = false
				ToggleBtn.Font = Enum.Font.GothamSemibold
				ToggleBtn.Text = "   " .. text
				ToggleBtn.TextColor3 = Colors.Text
				ToggleBtn.TextSize = 15
				ToggleBtn.TextXAlignment = Enum.TextXAlignment.Left
				ToggleBtn.RichText = false 
				
				CreateGlassEffect(ToggleBtn)
				
				local ToggleBtnC = Instance.new("UICorner")
				ToggleBtnC.CornerRadius = UDim.new(0, 6)
				ToggleBtnC.Parent = ToggleBtn
				
				sectionInfo.originalTexts[ToggleModule] = text
				
				local ToggleDisable = Instance.new("Frame")
				ToggleDisable.Name = "ToggleDisable"
				ToggleDisable.Parent = ToggleBtn
				ToggleDisable.BackgroundColor3 = Colors.Primary
				ToggleDisable.BackgroundTransparency = 0.5
				ToggleDisable.BorderSizePixel = 0
				ToggleDisable.Position = UDim2.new(1, -38, 0.5, -13)
				ToggleDisable.Size = UDim2.new(0, 26, 0, 26)
				
				local ToggleSwitch = Instance.new("Frame")
				ToggleSwitch.Name = "ToggleSwitch"
				ToggleSwitch.Parent = ToggleDisable
				ToggleSwitch.BackgroundColor3 = Colors.White
				ToggleSwitch.Size = UDim2.new(0, 22, 0, 22)
				ToggleSwitch.Position = UDim2.new(0, 2, 0, 2)
				
				local ToggleDisableC = Instance.new("UICorner")
				ToggleDisableC.CornerRadius = UDim.new(0, 6)
				ToggleDisableC.Parent = ToggleDisable
				
				local ToggleSwitchC = Instance.new("UICorner")
				ToggleSwitchC.CornerRadius = UDim.new(0, 4)
				ToggleSwitchC.Parent = ToggleSwitch
				
				local funcs = {
					SetState = function(self, state)
						if state == nil then
							state = not library.flags[flag]
						end
						if library.flags[flag] == state then
							return
						end
						Tween(ToggleSwitch, 0.15, "Sine", "Out", {
							Position = UDim2.new(0, (state and 2 or 2), 0, 2),
							BackgroundColor3 = state and Colors.Accent or Colors.White
						})
						library.flags[flag] = state
						callback(state)
                        
                        local config = getCurrentConfig()
                        saveConfig(config)
					end,
					Module = ToggleModule,
				}
				
				if enabled then
					funcs:SetState(true)
				end
				
				ToggleBtn.MouseButton1Click:Connect(function()
					funcs:SetState()
				end)
				
				return funcs
			end
			
			function section.Keybind(section, text, default, callback)
				local callback = callback or function() end
				assert(text, "No text provided")
				assert(default, "No default key provided")
				local default = (typeof(default) == "string" and Enum.KeyCode[default] or default)
				local banned = {
					Return = true,
					Space = true,
					Tab = true,
					Backquote = true,
					CapsLock = true,
					Escape = true,
					Unknown = true,
				}
				local shortNames = {
					RightControl = "Right Ctrl",
					LeftControl = "Left Ctrl",
					LeftShift = "Left Shift",
					RightShift = "Right Shift",
					Semicolon = ";",
					Quote = '"',
					LeftBracket = "[",
					RightBracket = "]",
					Equals = "=",
					Minus = "-",
					RightAlt = "Right Alt",
					LeftAlt = "Left Alt",
				}
				local bindKey = default
				local keyTxt = (default and (shortNames[default.Name] or default.Name) or "None")
				table.insert(tabInfo.searchableComponents, text)
				table.insert(sectionInfo.components, text)
				
				local KeybindModule = Instance.new("Frame")
				KeybindModule.Name = "KeybindModule"
				KeybindModule.Parent = Objs
				KeybindModule.BackgroundTransparency = 1
				KeybindModule.Size = UDim2.new(1, 0, 0, 40)
				
				local KeybindBtn = Instance.new("TextButton")
				KeybindBtn.Name = "KeybindBtn"
				KeybindBtn.Parent = KeybindModule
				KeybindBtn.BackgroundColor3 = Colors.Secondary
				KeybindBtn.BackgroundTransparency = 0.3
				KeybindBtn.Size = UDim2.new(1, 0, 1, 0)
				KeybindBtn.AutoButtonColor = false
				KeybindBtn.Font = Enum.Font.GothamSemibold
				KeybindBtn.Text = "   " .. text
				KeybindBtn.TextColor3 = Colors.Text
				KeybindBtn.TextSize = 15
				KeybindBtn.TextXAlignment = Enum.TextXAlignment.Left
				KeybindBtn.RichText = false 
				
				CreateGlassEffect(KeybindBtn)
				
				local KeybindBtnC = Instance.new("UICorner")
				KeybindBtnC.CornerRadius = UDim.new(0, 6)
				KeybindBtnC.Parent = KeybindBtn
				
				sectionInfo.originalTexts[KeybindModule] = text
				
				local KeybindValue = Instance.new("TextButton")
				KeybindValue.Name = "KeybindValue"
				KeybindValue.Parent = KeybindBtn
				KeybindValue.BackgroundColor3 = Colors.Primary
				KeybindValue.BackgroundTransparency = 0.5
				KeybindValue.Position = UDim2.new(1, -60, 0.5, -14)
				KeybindValue.Size = UDim2.new(0, 55, 0, 28)
				KeybindValue.AutoButtonColor = false
				KeybindValue.Font = Enum.Font.GothamSemibold
				KeybindValue.Text = keyTxt
				KeybindValue.TextColor3 = Colors.Text
				KeybindValue.TextSize = 14
				
				local KeybindValueC = Instance.new("UICorner")
				KeybindValueC.CornerRadius = UDim.new(0, 6)
				KeybindValueC.Parent = KeybindValue
				
				local KeybindL = Instance.new("UIListLayout")
				KeybindL.Name = "KeybindL"
				KeybindL.Parent = KeybindBtn
				KeybindL.HorizontalAlignment = Enum.HorizontalAlignment.Right
				KeybindL.SortOrder = Enum.SortOrder.LayoutOrder
				KeybindL.VerticalAlignment = Enum.VerticalAlignment.Center
				
				local UIPadding = Instance.new("UIPadding")
				UIPadding.Parent = KeybindBtn
				UIPadding.PaddingRight = UDim.new(0, 6)
				
				services.UserInputService.InputBegan:Connect(function(inp, gpe)
					if gpe then return end
					if inp.UserInputType ~= Enum.UserInputType.Keyboard then return end
					if inp.KeyCode ~= bindKey then return end
					callback(bindKey.Name)
				end)
				
				KeybindValue.MouseButton1Click:Connect(function()
					KeybindValue.Text = "..."
					wait()
					local key, uwu = services.UserInputService.InputEnded:Wait()
					local keyName = tostring(key.KeyCode.Name)
					if key.UserInputType ~= Enum.UserInputType.Keyboard then
						KeybindValue.Text = keyTxt
						return
					end
					if banned[keyName] then
						KeybindValue.Text = keyTxt
						return
					end
					wait()
					bindKey = Enum.KeyCode[keyName]
					local displayName = shortNames[keyName] or keyName
					KeybindValue.Text = displayName
					keyTxt = displayName
				end)
				
				KeybindValue:GetPropertyChangedSignal("TextBounds"):Connect(function()
					KeybindValue.Size = UDim2.new(0, KeybindValue.TextBounds.X + 30, 0, 28)
				end)
				
				KeybindValue.Size = UDim2.new(0, KeybindValue.TextBounds.X + 30, 0, 28)
			end
			
			function section.Textbox(section, text, flag, default, callback)
				local callback = callback or function() end
				assert(text, "No text provided")
				assert(flag, "No flag provided")
				assert(default, "No default text provided")
				library.flags[flag] = default
				table.insert(tabInfo.searchableComponents, text)
				table.insert(sectionInfo.components, text)
				
				local TextboxModule = Instance.new("Frame")
				TextboxModule.Name = "TextboxModule"
				TextboxModule.Parent = Objs
				TextboxModule.BackgroundTransparency = 1
				TextboxModule.Size = UDim2.new(1, 0, 0, 40)
				
				local TextboxBack = Instance.new("TextButton")
				TextboxBack.Name = "TextboxBack"
				TextboxBack.Parent = TextboxModule
				TextboxBack.BackgroundColor3 = Colors.Secondary
				TextboxBack.BackgroundTransparency = 0.3
				TextboxBack.Size = UDim2.new(1, 0, 1, 0)
				TextboxBack.AutoButtonColor = false
				TextboxBack.Font = Enum.Font.GothamSemibold
				TextboxBack.Text = "   " .. text
				TextboxBack.TextColor3 = Colors.Text
				TextboxBack.TextSize = 15
				TextboxBack.TextXAlignment = Enum.TextXAlignment.Left
				TextboxBack.RichText = false 
				
				CreateGlassEffect(TextboxBack)
				
				local TextboxBackC = Instance.new("UICorner")
				TextboxBackC.CornerRadius = UDim.new(0, 6)
				TextboxBackC.Parent = TextboxBack
				
				sectionInfo.originalTexts[TextboxModule] = text
				
				local BoxBG = Instance.new("TextButton")
				BoxBG.Name = "BoxBG"
				BoxBG.Parent = TextboxBack
				BoxBG.BackgroundColor3 = Colors.Primary
				BoxBG.BackgroundTransparency = 0.5
				BoxBG.Position = UDim2.new(1, -100, 0.5, -14)
				BoxBG.Size = UDim2.new(0, 90, 0, 28)
				BoxBG.AutoButtonColor = false
				BoxBG.Text = ""
				
				local BoxBGC = Instance.new("UICorner")
				BoxBGC.CornerRadius = UDim.new(0, 6)
				BoxBGC.Parent = BoxBG
				
				local TB = Instance.new("TextBox")
				TB.Name = "TextBox"
				TB.Parent = BoxBG
				TB.BackgroundTransparency = 1
				TB.Size = UDim2.new(1, 0, 1, 0)
				TB.Font = Enum.Font.Gotham
				TB.PlaceholderText = default
				TB.Text = default
				TB.TextColor3 = Colors.Text
				TB.PlaceholderColor3 = Colors.Placeholder
				TB.TextSize = 14
				TB.ClearTextOnFocus = true
                
                if currentConfig.flags and currentConfig.flags[flag] ~= nil then
                    TB.Text = tostring(currentConfig.flags[flag])
                    library.flags[flag] = currentConfig.flags[flag]
                end
				
				TB.Focused:Connect(function()
					if TB.Text == default then
						TB.Text = ""
					end
				end)
				
				TextboxBack:GetPropertyChangedSignal("AbsoluteSize"):Connect(function()
					BoxBG.Position = UDim2.new(1, -100, 0.5, -14)
				end)
				
				TB.FocusLost:Connect(function()
					if TB.Text == "" then
						TB.Text = default
					end
					library.flags[flag] = TB.Text
					callback(TB.Text)
                    
                    local config = getCurrentConfig()
                    saveConfig(config)
				end)
				
				TB:GetPropertyChangedSignal("TextBounds"):Connect(function()
					BoxBG.Size = UDim2.new(0, TB.TextBounds.X + 40, 0, 28)
				end)
				
				BoxBG.Size = UDim2.new(0, TB.TextBounds.X + 40, 0, 28)
				
				local funcs = {
					GetValue = function() return TB.Text end,
					SetValue = function(self, value) 
						TB.Text = tostring(value)
						library.flags[flag] = value
						callback(value)
                        
                        local config = getCurrentConfig()
                        saveConfig(config)
					end,
					Module = TextboxModule
				}
				
				return funcs
			end
			
			function section.Slider(section, text, flag, default, min, max, precise, callback)
				local callback = callback or function() end
				local min = min or 1
				local max = max or 10
				local default = default or min
				local precise = precise or false
				library.flags[flag] = default
				assert(text, "No text provided")
				assert(flag, "No flag provided")
				assert(default, "No default value provided")
				table.insert(tabInfo.searchableComponents, text)
				table.insert(sectionInfo.components, text)
				
				local SliderModule = Instance.new("Frame")
				SliderModule.Name = "SliderModule"
				SliderModule.Parent = Objs
				SliderModule.BackgroundTransparency = 1
				SliderModule.ClipsDescendants = true
				SliderModule.Size = UDim2.new(1, 0, 0, 40)
				
				local SliderBack = Instance.new("TextButton")
				SliderBack.Name = "SliderBack"
				SliderBack.Parent = SliderModule
				SliderBack.BackgroundColor3 = Colors.Secondary
				SliderBack.BackgroundTransparency = 0.3
				SliderBack.Size = UDim2.new(1, 0, 1, 0)
				SliderBack.AutoButtonColor = false
				SliderBack.Font = Enum.Font.GothamSemibold
				SliderBack.Text = "   " .. text
				SliderBack.TextColor3 = Colors.Text
				SliderBack.TextSize = 15
				SliderBack.TextXAlignment = Enum.TextXAlignment.Left
				SliderBack.RichText = false
				
				CreateGlassEffect(SliderBack)
				
				local SliderBackC = Instance.new("UICorner")
				SliderBackC.CornerRadius = UDim.new(0, 6)
				SliderBackC.Parent = SliderBack
				
				sectionInfo.originalTexts[SliderModule] = text
				
				local SliderBar = Instance.new("Frame")
				SliderBar.Name = "SliderBar"
				SliderBar.Parent = SliderBack
				SliderBar.AnchorPoint = Vector2.new(0, 0.5)
				SliderBar.BackgroundColor3 = Colors.Primary
				SliderBar.BackgroundTransparency = 0.5
				SliderBar.BorderSizePixel = 0
				SliderBar.Position = UDim2.new(0.5, -60, 0.5, 0)
				SliderBar.Size = UDim2.new(0, 120, 0, 6)
				
				local SliderBarC = Instance.new("UICorner")
				SliderBarC.CornerRadius = UDim.new(0, 3)
				SliderBarC.Parent = SliderBar
				
				local SliderPart = Instance.new("Frame")
				SliderPart.Name = "SliderPart"
				SliderPart.Parent = SliderBar
				SliderPart.BackgroundColor3 = Colors.Accent
				SliderPart.Size = UDim2.new(0.5, 0, 1, 0)
				
				local SliderPartC = Instance.new("UICorner")
				SliderPartC.CornerRadius = UDim.new(0, 3)
				SliderPartC.Parent = SliderPart
				
				local SliderValBG = Instance.new("TextButton")
				SliderValBG.Name = "SliderValBG"
				SliderValBG.Parent = SliderBack
				SliderValBG.BackgroundColor3 = Colors.Primary
				SliderValBG.BackgroundTransparency = 0.5
				SliderValBG.Position = UDim2.new(1, -45, 0.5, -14)
				SliderValBG.Size = UDim2.new(0, 40, 0, 28)
				SliderValBG.AutoButtonColor = false
				SliderValBG.Font = Enum.Font.Gotham
				SliderValBG.Text = ""
				
				local SliderValBGC = Instance.new("UICorner")
				SliderValBGC.CornerRadius = UDim.new(0, 6)
				SliderValBGC.Parent = SliderValBG
				
				local SliderValue = Instance.new("TextBox")
				SliderValue.Name = "SliderValue"
				SliderValue.Parent = SliderValBG
				SliderValue.BackgroundTransparency = 1
				SliderValue.Size = UDim2.new(1, 0, 1, 0)
				SliderValue.Font = Enum.Font.GothamSemibold
				SliderValue.Text = tostring(default)
				SliderValue.TextColor3 = Colors.Text
				SliderValue.TextSize = 14
				SliderValue.ClearTextOnFocus = true
				
				SliderValue.Focused:Connect(function()
					if SliderValue.Text == tostring(default) then
						SliderValue.Text = ""
					end
				end)
				
				local MinSlider = Instance.new("TextButton")
				MinSlider.Name = "MinSlider"
				MinSlider.Parent = SliderBack
				MinSlider.BackgroundTransparency = 1
				MinSlider.Position = UDim2.new(0.5, -85, 0.5, -10)
				MinSlider.Size = UDim2.new(0, 20, 0, 20)
				MinSlider.Font = Enum.Font.GothamBold
				MinSlider.Text = "-"
				MinSlider.TextColor3 = Colors.Text
				MinSlider.TextSize = 20
				
				local AddSlider = Instance.new("TextButton")
				AddSlider.Name = "AddSlider"
				AddSlider.Parent = SliderBack
				AddSlider.AnchorPoint = Vector2.new(0, 0.5)
				AddSlider.BackgroundTransparency = 1
				AddSlider.Position = UDim2.new(0.5, 70, 0.5, -10)
				AddSlider.Size = UDim2.new(0, 20, 0, 20)
				AddSlider.Font = Enum.Font.GothamBold
				AddSlider.Text = "+"
				AddSlider.TextColor3 = Colors.Text
				AddSlider.TextSize = 20
				
				local funcs = {
					SetValue = function(self, value)
						local percent = (mouse.X - SliderBar.AbsolutePosition.X) / SliderBar.AbsoluteSize.X
						if value then
							percent = (value - min) / (max - min)
						end
						percent = math.clamp(percent, 0, 1)
						if precise then
							value = value or tonumber(string.format("%.1f", tostring(min + (max - min) * percent)))
						else
							value = value or math.floor(min + (max - min) * percent)
						end
						library.flags[flag] = tonumber(value)
						SliderValue.Text = tostring(value)
						Tween(SliderPart, 0.1, "Linear", "Out", { Size = UDim2.new(percent, 0, 1, 0) })
						callback(tonumber(value))
                        
                        local config = getCurrentConfig()
                        saveConfig(config)
					end,
				}
                
                if currentConfig.flags and currentConfig.flags[flag] ~= nil then
                    funcs:SetValue(currentConfig.flags[flag])
                end
				
				MinSlider.MouseButton1Click:Connect(function()
					local currentValue = library.flags[flag]
					currentValue = math.clamp(currentValue - 1, min, max)
					funcs:SetValue(currentValue)
				end)
				
				AddSlider.MouseButton1Click:Connect(function()
					local currentValue = library.flags[flag]
					currentValue = math.clamp(currentValue + 1, min, max)
					funcs:SetValue(currentValue)
				end)
				
				funcs:SetValue(default)
				
				local dragging = false
				
				SliderBar.InputBegan:Connect(function(input)
					if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
						dragging = true
						funcs:SetValue()
					end
				end)
				
				services.UserInputService.InputEnded:Connect(function(input)
					if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) and dragging then
						dragging = false
					end
				end)
				
				services.UserInputService.InputChanged:Connect(function(input)
					if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
						funcs:SetValue()
					end
				end)
				
				local boxFocused = false
				SliderValue.Focused:Connect(function()
					boxFocused = true
				end)
				
				SliderValue.FocusLost:Connect(function()
					boxFocused = false
					if SliderValue.Text == "" then
						funcs:SetValue(default)
					end
				end)
				
				SliderValue:GetPropertyChangedSignal("Text"):Connect(function()
					if not boxFocused then return end
					SliderValue.Text = SliderValue.Text:gsub("%D+", "")
					local text = SliderValue.Text
					if not tonumber(text) then
						SliderValue.Text = SliderValue.Text:gsub("%D+", "")
					elseif text ~= "" then
						if tonumber(text) > max then
							text = max
							SliderValue.Text = tostring(max)
						end
						funcs:SetValue(tonumber(text))
					end
				end)
				
				return funcs
			end
			
			function section.Dropdown(section, text, flag, options, callback)
				local callback = callback or function() end
				local options = options or {}
				assert(text, "No text provided")
				assert(flag, "No flag provided")
				library.flags[flag] = nil
				table.insert(tabInfo.searchableComponents, text)
				table.insert(sectionInfo.components, text)
				
				local DropdownModule = Instance.new("Frame")
				DropdownModule.Name = "DropdownModule"
				DropdownModule.Parent = Objs
				DropdownModule.BackgroundTransparency = 1
				DropdownModule.ClipsDescendants = true
				DropdownModule.Size = UDim2.new(1, 0, 0, 40)
				
				local DropdownTop = Instance.new("TextButton")
				DropdownTop.Name = "DropdownTop"
				DropdownTop.Parent = DropdownModule
				DropdownTop.BackgroundColor3 = Colors.Secondary
				DropdownTop.BackgroundTransparency = 0.3
				DropdownTop.Size = UDim2.new(1, 0, 0, 40)
				DropdownTop.AutoButtonColor = false
				DropdownTop.Font = Enum.Font.GothamSemibold
				DropdownTop.Text = ""
				DropdownTop.TextXAlignment = Enum.TextXAlignment.Left
				DropdownTop.RichText = false
				
				CreateGlassEffect(DropdownTop)
				
				local DropdownTopC = Instance.new("UICorner")
				DropdownTopC.CornerRadius = UDim.new(0, 6)
				DropdownTopC.Parent = DropdownTop
				
				local DropdownText = Instance.new("TextBox")
				DropdownText.Name = "DropdownText"
				DropdownText.Parent = DropdownTop
				DropdownText.BackgroundTransparency = 1
				DropdownText.Position = UDim2.new(0, 40, 0, 0)
				DropdownText.Size = UDim2.new(1, -70, 1, 0)
				DropdownText.Font = Enum.Font.GothamSemibold
				DropdownText.PlaceholderText = text
				DropdownText.Text = ""
				DropdownText.TextColor3 = Colors.Text
				DropdownText.TextSize = 15
				DropdownText.TextXAlignment = Enum.TextXAlignment.Left
				DropdownText.ClearTextOnFocus = false
				DropdownText.RichText = false
				
				DropdownText.Focused:Connect(function()
					if DropdownText.Text == DropdownText.PlaceholderText then
						DropdownText.Text = ""
					end
				end)
				
				local DropdownOpen = Instance.new("TextButton")
				DropdownOpen.Name = "DropdownOpen"
				DropdownOpen.Parent = DropdownTop
				DropdownOpen.AnchorPoint = Vector2.new(0, 0.5)
				DropdownOpen.BackgroundTransparency = 1
				DropdownOpen.Position = UDim2.new(1, -30, 0.5, 0)
				DropdownOpen.Size = UDim2.new(0, 20, 0, 20)
				DropdownOpen.Font = Enum.Font.GothamBold
				DropdownOpen.Text = "+"
				DropdownOpen.TextColor3 = Colors.Text
				DropdownOpen.TextSize = 20
				
				local DropdownModuleL = Instance.new("UIListLayout")
				DropdownModuleL.Name = "DropdownModuleL"
				DropdownModuleL.Parent = DropdownModule
				DropdownModuleL.SortOrder = Enum.SortOrder.LayoutOrder
				DropdownModuleL.Padding = UDim.new(0, 4)
				
				local open = false
				local funcs = {
					AddOption = function(self, option)
						table.insert(sectionInfo.components, option)
						local Option = Instance.new("TextButton")
						Option.Name = "Option_" .. option
						Option.Parent = DropdownModule
						Option.BackgroundColor3 = Colors.Secondary
						Option.BackgroundTransparency = 0.3
						Option.Size = UDim2.new(1, 0, 0, 32)
						Option.AutoButtonColor = false
						Option.Font = Enum.Font.Gotham
						Option.Text = option
						Option.TextColor3 = Colors.Text
						Option.TextSize = 14
						Option.RichText = false
						
						CreateGlassEffect(Option)
						
						local OptionC = Instance.new("UICorner")
						OptionC.CornerRadius = UDim.new(0, 6)
						OptionC.Parent = Option
						
						sectionInfo.originalTexts[Option] = option
						
						Option.MouseButton1Click:Connect(function()
							open = false
							DropdownOpen.Text = "+"
							Tween(DropdownModule, 0.2, "Sine", "Out", { Size = UDim2.new(1, 0, 0, 40) })
							callback(Option.Text)
							DropdownText.Text = Option.Text
							library.flags[flag] = Option.Text
                            
                            local config = getCurrentConfig()
                            saveConfig(config)
						end)
					end,
					
					RemoveOption = function(self, option)
						local option = DropdownModule:FindFirstChild("Option_" .. option)
						if option then
							option:Destroy()
						end
					end,
					
					SetOptions = function(self, options)
						if not options or typeof(options) ~= "table" then return end
						for _, v in next, DropdownModule:GetChildren() do
							if v.Name:match("Option_") then
								v:Destroy()
							end
						end
						for _, v in next, options do
							self:AddOption(v)
						end
					end,
					
					ToggleDropVis = function()
						open = not open
						DropdownOpen.Text = (open and "-" or "+")
						Tween(DropdownModule, 0.2, "Sine", "Out", {
							Size = UDim2.new(1, 0, 0, (open and DropdownModuleL.AbsoluteContentSize.Y + 4 or 40))
						})
					end
				}
				
				DropdownOpen.MouseButton1Click:Connect(function()
					funcs:ToggleDropVis()
				end)
				
				DropdownModuleL:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
					if open then
						Tween(DropdownModule, 0.2, "Sine", "Out", { Size = UDim2.new(1, 0, 0, DropdownModuleL.AbsoluteContentSize.Y + 4) })
					end
				end)
				
				funcs:SetOptions(options)
				return funcs
			end
            
            if currentConfig.flags and currentConfig.flags[flag] then
                local selectedValue = currentConfig.flags[flag]
                for _, option in ipairs(options) do
                    if option == selectedValue then
                        DropdownText.Text = selectedValue
                        library.flags[flag] = selectedValue
                        break
                    end
                end
            end
			
			section.TextBox = section.Textbox
			section.textbox = section.Textbox
			section.KeyBind = section.Keybind
			section.keybind = section.Keybind
			
			return section
		end
		
		return tab
	end
	
	local SCALE = 0.008
	local LookView = Vector3.new(0, 0.5, -10)
	local renderConnection

	local uiFollowEnabled = true
	local dragModeEnabled = false
	local faceCharacterEnabled = false
	local aiPanelEnabled = false

    if currentConfig.uiFollowEnabled ~= nil then uiFollowEnabled = currentConfig.uiFollowEnabled end
    if currentConfig.dragModeEnabled ~= nil then dragModeEnabled = currentConfig.dragModeEnabled end
    if currentConfig.faceCharacterEnabled ~= nil then faceCharacterEnabled = currentConfig.faceCharacterEnabled end

	FaceBtn.MouseButton1Click:Connect(function()
		spawn(function()
			Ripple(FaceBtn)
		end)
		
		faceCharacterEnabled = not faceCharacterEnabled
		
		if faceCharacterEnabled then
			uiFollowEnabled = false
			dragModeEnabled = false
			Tween(FaceBtn, 0.2, "Sine", "Out", { ImageColor3 = Colors.Accent })
			Tween(FaceBtn, 0.2, "Sine", "Out", { BackgroundTransparency = 0 })
			Tween(DragModeBtn, 0.2, "Sine", "Out", { ImageColor3 = Colors.Text })
			Tween(DragModeBtn, 0.2, "Sine", "Out", { BackgroundTransparency = 0.3 })
			TitleBar.Active = false
		else
			uiFollowEnabled = true
			Tween(FaceBtn, 0.2, "Sine", "Out", { ImageColor3 = Colors.Text })
			Tween(FaceBtn, 0.2, "Sine", "Out", { BackgroundTransparency = 0.3 })
		end
        
        local config = getCurrentConfig()
        saveConfig(config)
	end)

	DragModeBtn.MouseButton1Click:Connect(function()
		spawn(function()
			Ripple(DragModeBtn)
		end)
		
		dragModeEnabled = not dragModeEnabled
		
		if dragModeEnabled then
			uiFollowEnabled = false
			faceCharacterEnabled = false
			Tween(DragModeBtn, 0.2, "Sine", "Out", { ImageColor3 = Colors.Accent })
			Tween(DragModeBtn, 0.2, "Sine", "Out", { BackgroundTransparency = 0 })
			Tween(FaceBtn, 0.2, "Sine", "Out", { ImageColor3 = Colors.Text })
			Tween(FaceBtn, 0.2, "Sine", "Out", { BackgroundTransparency = 0.3 })
			TitleBar.Active = true
		else
			uiFollowEnabled = true
			Tween(DragModeBtn, 0.2, "Sine", "Out", { ImageColor3 = Colors.Text })
			Tween(DragModeBtn, 0.2, "Sine", "Out", { BackgroundTransparency = 0.3 })
		end
        
        local config = getCurrentConfig()
        saveConfig(config)
	end)

	AIPanelBtn.MouseButton1Click:Connect(function()
		spawn(function()
			Ripple(AIPanelBtn)
		end)
		
		aiPanelEnabled = not aiPanelEnabled
		
		if aiPanelEnabled then
			Content.Visible = false
			AIPanelFrame.Visible = true
			Tween(AIPanelBtn, 0.2, "Sine", "Out", { ImageColor3 = Colors.Accent })
			Tween(AIPanelBtn, 0.2, "Sine", "Out", { BackgroundTransparency = 0 })
            
            if isFirstTimeAI then
                isFirstTimeAI = false
                wait(0.3)
                showAllCommands()
            end
		else
			AIPanelFrame.Visible = false
			Content.Visible = true
			Tween(AIPanelBtn, 0.2, "Sine", "Out", { ImageColor3 = Colors.Text })
			Tween(AIPanelBtn, 0.2, "Sine", "Out", { BackgroundTransparency = 0.3 })
		end
        
        local config = getCurrentConfig()
        saveConfig(config)
	end)
	
	local function update3DPosition(dt)
		if not canvasPart or not canvasPart.Parent then return end
		
		if faceCharacterEnabled then
			local character = services.Players.LocalPlayer.Character
			if character and character:FindFirstChild("HumanoidRootPart") then
				local rootPart = character.HumanoidRootPart
				local fixedPosition = rootPart.CFrame * CFrame.new(0, 2, -5)
				canvasPart.CFrame = fixedPosition
			end
		elseif dragModeEnabled or not uiFollowEnabled then
			canvasPart.CFrame = camera.CFrame * CFrame.new(LookView.X, LookView.Y, LookView.Z)
		else
			local offsetX = (mouse.X - mouse.ViewSizeX/2) * SCALE
			local offsetY = (mouse.Y - mouse.ViewSizeY/2) * SCALE
			
			local goalCFrame = camera.CFrame 
				* CFrame.new(LookView.X, LookView.Y, LookView.Z)
				* CFrame.Angles(0, math.rad(offsetX), 0)
				* CFrame.Angles(math.rad(offsetY), 0, 0)
			
			services.TweenService:Create(canvasPart, TweenInfo.new(dt * 2), {
				CFrame = goalCFrame
			}):Play()
		end
	end
	
	renderConnection = game:GetService("RunService").RenderStepped:Connect(update3DPosition)
    
    applyFullConfig(currentConfig)
	
	Tween(FaceBtn, 0, "Sine", "Out", { BackgroundTransparency = 0.3 })
	Tween(DragModeBtn, 0, "Sine", "Out", { BackgroundTransparency = 0.3 })
	Tween(AIPanelBtn, 0, "Sine", "Out", { BackgroundTransparency = 0.3 })

	drag(Main, TitleBar)

	function window:Set3DOffset(offsetVector)
		LookView = offsetVector
	end

	function window:GetCanvasPart()
		return canvasPart
	end

	function window:Destroy()
		if canvasPart then
			canvasPart:Destroy()
		end
		if renderConnection then
			renderConnection:Disconnect()
		end
	end

	return window
end

return library